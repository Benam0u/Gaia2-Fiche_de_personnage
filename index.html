<!--
  Cr√©√© par Benam0u ‚Äì 2025/07/08
  GAIA 2 ‚Äì Fiche de personnage
-->

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Fiche de personnage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ========== WIZARD DE CR√âATION ========== */
    .wizard-container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 1rem;
      overflow: hidden;
    }
    
    .wizard-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .wizard-title {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 28px;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }
    
    .wizard-subtitle {
      color: #7f8c8d;
      font-size: 16px;
    }
    
    .btn-start-wizard {
      display: inline-block;
      background: linear-gradient(135deg, #8b0000 0%, #a52a2a 100%);
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      padding: 1rem 2.5rem;
      border: none;
      border-radius: 2rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
      transition: all 0.3s ease;
      margin-top: 1rem;
    }
    
    .btn-start-wizard:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 0, 0, 0.4);
    }
    
    .btn-skip-wizard {
      display: block;
      margin: 1rem auto 0;
      background: transparent;
      border: 2px solid #bdc3c7;
      color: #7f8c8d;
      padding: 0.5rem 1.5rem;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .btn-skip-wizard:hover {
      border-color: #8b0000;
      color: #8b0000;
    }
    
    /* Wizard Steps Container */
    .wizard-steps {
      display: none;
    }
    
    .wizard-steps.active {
      display: block;
    }
    
    /* Progress Bar */
    .wizard-progress {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2rem;
      padding: 0 1rem;
      position: relative;
    }
    
    .wizard-progress::before {
      content: '';
      position: absolute;
      top: 18px;
      left: 2rem;
      right: 2rem;
      height: 3px;
      background: #ecf0f1;
      z-index: 0;
    }
    
    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      z-index: 1;
      cursor: pointer;
      min-height: 70px;
    }
    
    .progress-step .step-number {
      width: 36px;
      height: 36px;
      min-height: 36px;
      border-radius: 50%;
      background: #ecf0f1;
      color: #95a5a6;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
      border: 3px solid #ecf0f1;
    }
    
    .progress-step.active .step-number {
      background: #8b0000;
      color: #fff;
      border-color: #8b0000;
    }
    
    .progress-step.completed .step-number {
      background: #27ae60;
      color: #fff;
      border-color: #27ae60;
    }
    
    .progress-step .step-label {
      font-size: 11px;
      color: #95a5a6;
      margin-top: 0.5rem;
      text-align: center;
      max-width: 80px;
    }
    
    .progress-step.active .step-label,
    .progress-step.completed .step-label {
      color: #2c3e50;
      font-weight: bold;
    }
    
    /* Step Content */
    .step-content {
      display: none;
      background: #fff;
      border: 2px solid #333;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
      overflow-x: auto;
      max-width: 100%;
      box-sizing: border-box;
    }
    
    .step-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .step-title {
      font-size: 22px;
      color: #8b0000;
      margin: 0 0 0.5rem 0;
      text-align: center;
    }
    
    .step-description {
      color: #666;
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 14px;
    }
    
    /* Options Grid */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    /* Grille 4 colonnes pour les avantages */
    .options-grid-4col {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      max-width: 100%;
      overflow: hidden;
    }
    
    /* Responsive: r√©duire les colonnes sur petits √©crans */
    @media (max-width: 1200px) {
      .options-grid-4col {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 900px) {
      .options-grid-4col {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* Carte simple sans image */
    .option-card-simple {
      border: 2px solid #ddd;
      border-radius: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
    }
    
    .option-card-simple:hover {
      border-color: #8b0000;
      background: #fff;
      transform: translateY(-2px);
    }
    
    .option-card-simple.selected {
      border-color: #8b0000;
      background: #fff5f5;
      box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
    }
    
    .option-card-simple .option-name {
      font-weight: bold;
      font-size: 14px;
      color: #2c3e50;
      margin-bottom: 0.25rem;
    }
    
    .option-card-simple .option-desc {
      font-size: 12px;
      color: #333;
    }
    
    /* Checkbox simple pour grille 4 colonnes */
    .option-checkbox-simple {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
      overflow: hidden;
      word-wrap: break-word;
      min-width: 0;
    }
    
    .option-checkbox-simple > div {
      min-width: 0;
      overflow: hidden;
    }
    
    .option-checkbox-simple:hover {
      border-color: #8b0000;
      background: #fff;
    }
    
    .option-checkbox-simple.selected {
      border-color: #8b0000;
      background: #fff5f5;
    }
    
    .option-checkbox-simple .checkbox-mark {
      width: 18px;
      height: 18px;
      border: 2px solid #8b0000;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 12px;
    }
    
    .option-checkbox-simple.selected .checkbox-mark::after {
      content: '‚úì';
      color: #8b0000;
      font-weight: bold;
    }
    
    .option-checkbox-simple .option-name {
      font-weight: bold;
      font-size: 13px;
      color: #2c3e50;
      margin-bottom: 0.15rem;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    .option-checkbox-simple .option-desc {
      font-size: 11px;
      color: #333;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    /* Section titles for advantages */
    .advantages-section-title {
      font-size: 1rem;
      font-weight: bold;
      color: #8b0000;
      margin: 1.5rem 0 0.75rem 0;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #8b0000;
    }
    
    .advantages-section-title:first-child {
      margin-top: 0;
    }
    
    /* Custom advantages */
    .custom-advantages-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    .custom-advantage-card {
      flex: 1;
      min-width: 280px;
      max-width: calc(50% - 0.5rem);
      border: 2px solid #8b0000;
      border-radius: 0.5rem;
      padding: 0.75rem;
      background: #fff5f5;
    }
    
    .custom-advantage-header {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .custom-advantage-name {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 0.25rem;
      font-weight: bold;
      font-size: 13px;
    }
    
    .custom-advantage-name:focus {
      outline: none;
      border-color: #8b0000;
    }
    
    .custom-advantage-remove {
      width: 28px;
      height: 28px;
      border: none;
      background: #e74c3c;
      color: white;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .custom-advantage-remove:hover {
      background: #c0392b;
    }
    
    .custom-advantage-desc {
      width: 100%;
      min-height: 60px;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 0.25rem;
      resize: vertical;
      font-size: 11px;
      font-family: inherit;
    }
    
    .custom-advantage-desc:focus {
      outline: none;
      border-color: #8b0000;
    }
    
    .custom-advantage-add {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 280px;
      max-width: calc(50% - 0.5rem);
      min-height: 120px;
      border: 2px dashed #bbb;
      border-radius: 0.5rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
    }
    
    .custom-advantage-add:hover {
      border-color: #8b0000;
      background: #fff5f5;
    }
    
    .custom-advantage-add .add-icon {
      font-size: 2.5rem;
      color: #8b0000;
      line-height: 1;
    }
    
    .custom-advantage-add .add-text {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #666;
    }
    
    /* Level Up System */
    .levelup-points-display {
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 0.75rem;
      border: 2px solid #ddd;
    }
    
    .levelup-points-remaining {
      font-size: 2rem;
      font-weight: bold;
      color: #27ae60;
    }
    
    .levelup-points-remaining.warning {
      color: #f39c12;
    }
    
    .levelup-points-remaining.spent {
      color: #8b0000;
    }
    
    .levelup-options-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    @media (max-width: 900px) {
      .levelup-options-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .levelup-option-card {
      border: 2px solid #ddd;
      border-radius: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
      text-align: center;
    }
    
    .levelup-option-card:hover:not(.disabled) {
      border-color: #8b0000;
      background: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .levelup-option-card.selected {
      border-color: #8b0000;
      background: #fff5f5;
      box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
    }
    
    .levelup-option-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #eee;
    }
    
    .levelup-option-cost {
      display: inline-block;
      background: #8b0000;
      color: #fff;
      font-weight: bold;
      font-size: 14px;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .levelup-option-name {
      font-weight: bold;
      font-size: 14px;
      color: #2c3e50;
      margin-bottom: 0.25rem;
    }
    
    .levelup-option-desc {
      font-size: 11px;
      color: #666;
    }
    
    .levelup-selection-panel {
      border: 2px solid #8b0000;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-top: 1rem;
      background: #fff5f5;
    }
    
    .levelup-selection-title {
      font-weight: bold;
      font-size: 16px;
      color: #8b0000;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #8b0000;
    }
    
    .levelup-choices-list {
      margin-top: 1rem;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 0.5rem;
      border: 1px solid #ddd;
    }
    
    .levelup-choice-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      background: #fff;
      border-radius: 0.25rem;
      border: 1px solid #ddd;
    }
    
    .levelup-choice-item:last-child {
      margin-bottom: 0;
    }
    
    .levelup-choice-remove {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 12px;
    }
    
    .levelup-choice-remove:hover {
      background: #c0392b;
    }

    .option-card {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      border: 2px solid #ddd;
      border-radius: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
    }
    
    .option-card .option-img {
      width: 50%;
      min-height: 150px;
      object-fit: contain;
      background: #f0f0f0;
      flex-shrink: 0;
    }
    
    .option-card .option-content {
      width: 50%;
      padding: 1rem;
    }
    
    .option-card:hover {
      border-color: #8b0000;
      background: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .option-card.selected {
      border-color: #8b0000;
      background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
      box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.2);
    }
    
    .option-card .option-name,
    .option-checkbox .option-name {
      font-weight: bold;
      font-size: 16px;
      color: #2c3e50;
      margin-bottom: 0.25rem;
    }
    
    .option-card .option-desc,
    .option-checkbox .option-desc {
      font-size: 13px;
      color: #333;
      margin-bottom: 0.5rem;
    }
    
    .option-card .option-bonuses {
      font-size: 12px;
      color: #333;
      list-style: disc;
      padding-left: 1.2rem;
      margin: 0.5rem 0 0 0;
    }
    
    .option-card .option-bonuses li {
      margin-bottom: 0.15rem;
    }
    
    .option-card .option-maluses {
      font-size: 12px;
      color: #333;
      list-style: disc;
      padding-left: 1.2rem;
      margin: 0.25rem 0 0 0;
    }
    
    .option-card .option-maluses li {
      margin-bottom: 0.15rem;
    }
    
    /* Dice System for Attributes */
    .dice-pool {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 1rem;
      border-radius: 0.75rem;
      border: 2px dashed #bdc3c7;
    }
    
    /* Attribute distribution grid */
    .attr-distribute {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.75rem;
    }
    
    /* Name and alignment layout */
    .name-alignment-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    /* Stats recap grid */
    .stats-recap-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    /* Level up controls */
    .levelup-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      padding: 0 0.5rem;
    }
    
    .dice-item {
      width: 60px;
      height: 60px;
      border: 3px solid #8b0000;
      border-radius: 0.5rem;
      background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      color: #8b0000;
      cursor: grab;
      transition: all 0.2s ease;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }
    
    .dice-item:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
    }
    
    .dice-item.selected {
      background: #8b0000;
      color: #fff;
      transform: scale(1.15);
    }
    
    .dice-item.used {
      opacity: 0.3;
      cursor: not-allowed;
      border-style: dashed;
    }
    
    .attr-item {
      text-align: center;
      padding: 1rem 0.5rem;
      border: 2px solid #ddd;
      border-radius: 0.75rem;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .attr-item:hover {
      border-color: #8b0000;
      background: #fff;
    }
    
    .attr-item.has-dice {
      border-color: #27ae60;
      background: linear-gradient(135deg, #f0fff4 0%, #fff 100%);
    }
    
    .attr-item.selected-target {
      border-color: #8b0000;
      border-width: 3px;
      background: #fff5f5;
      box-shadow: 0 0 0 4px rgba(139, 0, 0, 0.2);
    }
    
    .attr-item label {
      display: block;
      font-weight: bold;
      color: #666;
      margin-bottom: 0.5rem;
      font-size: 14px;
      pointer-events: none;
    }
    
    .attr-item .attr-dice-display {
      font-size: 24px;
      font-weight: bold;
      color: #8b0000;
      margin: 0.25rem 0;
    }
    
    .attr-item .attr-value-display {
      font-size: 14px;
      color: #666;
    }
    
    .attr-item .attr-empty {
      font-size: 14px;
      color: #999;
      font-style: italic;
    }
    
    .dice-instructions {
      text-align: center;
      font-size: 13px;
      color: #666;
      margin-bottom: 1rem;
      padding: 0.5rem;
      background: #fff3cd;
      border-radius: 0.5rem;
    }
    
    /* Competences Distribution */
    .comp-distribute {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }
    
    .comp-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.75rem;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      background: #fafafa;
      font-size: 14px;
    }
    
    .comp-item .comp-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .comp-item .comp-attr {
      background: #eee;
      padding: 0.15rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 11px;
      color: #666;
    }
    
    .comp-item .comp-controls {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .comp-item .comp-controls button {
      width: 22px;
      height: 22px;
      border: none;
      border-radius: 50%;
      background: #8b0000;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }
    
    .comp-item .comp-controls button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .comp-item .comp-value {
      font-weight: bold;
      min-width: 30px;
      text-align: center;
    }
    
    .comp-item.has-points {
      background: linear-gradient(135deg, #f0fff4 0%, #fff 100%);
      border-color: #27ae60;
    }
    
    .comp-item .comp-controls button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Level Up Section */
    .level-up-section {
      margin-bottom: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 0.5rem;
    }
    
    .level-up-section h4 {
      margin: 0 0 0.75rem 0;
      color: #8b0000;
    }
    
    .level-options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .level-option {
      padding: 0.5rem 1rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      cursor: pointer;
      background: #fff;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .level-option:hover {
      border-color: #8b0000;
    }
    
    .level-option.selected {
      border-color: #8b0000;
      background: #fff5f5;
    }
    
    /* Navigation Buttons */
    .step-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
    }
    
    .btn-prev, .btn-next, .btn-confirm {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-prev {
      background: #fff;
      border: 2px solid #bdc3c7;
      color: #7f8c8d;
    }
    
    .btn-prev:hover {
      border-color: #8b0000;
      color: #8b0000;
    }
    
    .btn-next, .btn-confirm {
      background: #8b0000;
      border: none;
      color: #fff;
    }
    
    .btn-next:hover, .btn-confirm:hover {
      background: #a52a2a;
    }
    
    .btn-next:disabled, .btn-confirm:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Checkbox styles for multi-select */
    .option-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafafa;
    }
    
    .option-checkbox:hover {
      border-color: #8b0000;
      background: #fff;
    }
    
    .option-checkbox.selected {
      border-color: #8b0000;
      background: #fff5f5;
    }
    
    .option-checkbox input[type="checkbox"] {
      display: none;
    }
    
    .option-checkbox .checkbox-mark {
      width: 20px;
      height: 20px;
      border: 2px solid #8b0000;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .option-checkbox.selected .checkbox-mark::after {
      content: '‚úì';
      color: #8b0000;
      font-weight: bold;
    }
    
    .selection-count {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 1rem;
    }
    
    .selection-count strong {
      color: #8b0000;
    }
    
    /* Separator before sheet */
    .wizard-separator {
      max-width: 1000px;
      margin: 0 auto 2rem;
      padding: 1rem;
      text-align: center;
      border-top: 3px dashed #8b0000;
    }
    
    .wizard-separator span {
      background: #fdfdfd;
      padding: 0 1rem;
      color: #8b0000;
      font-weight: bold;
      font-size: 18px;
      position: relative;
      top: -1.75rem;
    }
    
    /* ============================================
       STYLES RESPONSIVES MOBILE
       ============================================ */
    
    /* Tablettes */
    @media screen and (max-width: 1024px) {
      .options-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
      }
      
      .options-grid-4col {
        grid-template-columns: repeat(2, 1fr) !important;
      }
    }
    
    /* Mobile - Tous les t√©l√©phones */
    @media screen and (max-width: 768px) {
      /* Reset global */
      html, body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
      }
      
      * {
        box-sizing: border-box !important;
      }
      
      /* Wizard container */
      .wizard-container {
        padding: 0.5rem !important;
        margin: 0.5rem auto !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
      }
      
      .wizard-header h1 {
        font-size: 1.3rem !important;
      }
      
      .wizard-header p {
        font-size: 0.85rem !important;
      }
      
      .btn-start-wizard {
        font-size: 14px !important;
        padding: 0.75rem 1.25rem !important;
        width: 90% !important;
        max-width: 280px !important;
      }
      
      .btn-skip-wizard {
        font-size: 12px !important;
        padding: 0.5rem 1rem !important;
      }
      
      /* Progress bar - Version compacte */
      .wizard-progress {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 0.25rem !important;
        justify-content: center !important;
        align-items: center !important;
        padding: 0.5rem !important;
      }
      
      .wizard-progress::before {
        top: 50% !important;
        transform: translateY(-50%) !important;
      }
      
      .progress-step {
        min-width: auto !important;
        min-height: auto !important;
        padding: 0.2rem !important;
        flex: 0 0 auto !important;
      }
      
      .step-number {
        width: 26px !important;
        height: 26px !important;
        min-height: 26px !important;
        font-size: 11px !important;
        border-radius: 50% !important;
      }
      
      .step-label {
        display: none !important;
      }
      
      /* Step content */
      .step-content {
        padding: 0.75rem !important;
        margin: 0 !important;
        border-radius: 0.5rem !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
      }
      
      .step-title {
        font-size: 1.1rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .step-description {
        font-size: 0.8rem !important;
        margin-bottom: 0.75rem !important;
      }
      
      /* GRILLES - Forcer 1 colonne */
      .options-grid,
      .options-grid-4col,
      .levelup-options-grid {
        display: flex !important;
        flex-direction: column !important;
        gap: 0.75rem !important;
        width: 100% !important;
      }
      
      /* CARTES DE RACE/CLASSE avec images - Layout horizontal */
      .option-card {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        align-items: flex-start !important;
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 0.75rem !important;
        overflow: hidden !important;
      }
      
      .option-card .option-img,
      .option-card > img {
        width: 40% !important;
        min-width: 40% !important;
        max-width: 40% !important;
        height: auto !important;
        min-height: 120px !important;
        max-height: none !important;
        object-fit: cover !important;
        flex-shrink: 0 !important;
        align-self: stretch !important;
      }
      
      .option-card-text-content,
      .option-card .option-content,
      .option-card > div:not(img) {
        width: 60% !important;
        min-width: 60% !important;
        max-width: 60% !important;
        max-height: none !important;
        height: auto !important;
        padding: 0.5rem !important;
        overflow: visible !important;
        box-sizing: border-box !important;
      }
      
      .option-card .option-name {
        font-size: 14px !important;
        font-weight: bold !important;
        margin-bottom: 0.3rem !important;
      }
      
      .option-card .option-desc {
        font-size: 11px !important;
        line-height: 1.35 !important;
      }
      
      .option-bonuses,
      .option-maluses {
        font-size: 10px !important;
        margin-top: 0.4rem !important;
        padding-left: 1rem !important;
      }
      
      .option-bonuses li,
      .option-maluses li {
        font-size: 10px !important;
        margin-bottom: 0.15rem !important;
        line-height: 1.3 !important;
      }
      
      /* CARTES SIMPLES (avantages) */
      .option-checkbox-simple {
        padding: 0.75rem !important;
        width: 100% !important;
      }
      
      .option-checkbox-simple .option-name {
        font-size: 14px !important;
      }
      
      .option-checkbox-simple .option-desc {
        font-size: 12px !important;
      }
      
      /* Navigation buttons */
      .step-navigation {
        display: flex !important;
        flex-direction: column !important;
        gap: 0.5rem !important;
        margin-top: 1rem !important;
      }
      
      .step-navigation button,
      .btn-prev, .btn-next, .btn-confirm {
        width: 100% !important;
        padding: 0.75rem 1rem !important;
        font-size: 14px !important;
        min-height: 44px !important;
      }
      
      /* Attributes distribution */
      #attr-distribute,
      .attr-distribute {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 0.5rem !important;
      }
      
      .attr-item {
        min-height: 80px !important;
        padding: 0.5rem !important;
      }
      
      .attr-item label {
        font-size: 14px !important;
      }
      
      .attr-item .attr-dice-display {
        font-size: 20px !important;
      }
      
      .attr-item .attr-value-display {
        font-size: 12px !important;
      }
      
      /* Dice pool */
      .dice-pool {
        display: flex !important;
        flex-wrap: wrap !important;
        justify-content: center !important;
        gap: 0.5rem !important;
        padding: 0.75rem !important;
      }
      
      .dice-item {
        width: 50px !important;
        height: 50px !important;
        font-size: 14px !important;
      }
      
      /* Level up */
      .levelup-option-card {
        padding: 0.75rem !important;
        width: 100% !important;
      }
      
      .levelup-controls {
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.5rem !important;
      }
      
      .levelup-selection-panel {
        padding: 0.75rem !important;
        overflow-x: hidden !important;
      }
      
      .levelup-selection-panel > div {
        overflow-x: hidden !important;
      }
      
      /* Level up characteristic selection - responsive grid */
      .levelup-carac-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.4rem !important;
      }
      
      .levelup-carac-grid button {
        font-size: 10px !important;
        padding: 0.3rem !important;
      }
      
      /* Level up competence/advantage selection - no scroll, full list */
      .levelup-comp-grid,
      .levelup-adv-grid {
        max-height: none !important;
        overflow-y: visible !important;
        grid-template-columns: 1fr !important;
      }
      
      .levelup-choice-item {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 0.5rem !important;
      }
      
      /* Competences step - 1 column on mobile */
      #comp-list {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 0.4rem !important;
      }
      
      .comp-distribute {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.3rem !important;
        overflow: hidden !important;
      }
      
      .comp-item {
        font-size: 10px !important;
        padding: 0.3rem 0.4rem !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        overflow: hidden !important;
      }
      
      .comp-item .comp-info {
        gap: 0.2rem !important;
        flex-shrink: 1 !important;
        min-width: 0 !important;
        overflow: hidden !important;
      }
      
      .comp-item .comp-name {
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-width: 70px !important;
      }
      
      .comp-item .comp-attr {
        font-size: 8px !important;
        padding: 0.1rem 0.2rem !important;
        flex-shrink: 0 !important;
      }
      
      .comp-item .comp-controls {
        flex-shrink: 0 !important;
        gap: 0.15rem !important;
      }
      
      .comp-item .comp-controls button {
        width: 18px !important;
        height: 18px !important;
        font-size: 12px !important;
      }
      
      .comp-item .comp-value {
        min-width: 20px !important;
        font-size: 10px !important;
      }
      
      /* Custom advantages */
      .custom-advantages-container {
        display: flex !important;
        flex-direction: column !important;
        gap: 0.5rem !important;
      }
      
      .custom-advantage-card,
      .custom-advantage-add {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
      }
      
      /* Name and stats step */
      .name-alignment-grid {
        display: block !important;
      }
      
      .name-alignment-grid > div {
        margin-bottom: 1rem !important;
      }
      
      .stats-recap-grid {
        display: block !important;
      }
      
      .stats-recap-grid > div {
        margin-bottom: 0.75rem !important;
      }
      
      /* Selection count */
      .selection-count {
        font-size: 0.85rem !important;
        margin-bottom: 0.75rem !important;
      }
      
      /* Input zoom prevention on iOS */
      input[type="text"],
      input[type="number"],
      select,
      textarea {
        font-size: 16px !important;
      }
      
      /* ========== CHARACTER SHEET - M√™me layout, polices r√©duites de 50% ========== */
      .container {
        padding: 0.5rem !important;
        margin: 0.5rem auto !important;
        max-width: 100% !important;
      }
      
      .title-box {
        font-size: 12px !important;
        padding: 0.25rem !important;
      }
      
      .title-row {
        margin-bottom: 0.5rem !important;
      }
      
      /* Garder la grille 4 colonnes comme desktop */
      .attributes-and-vitals {
        gap: 0.5rem !important;
      }
      
      .attr-box {
        padding: 0.25rem !important;
        border-radius: 0.5rem !important;
      }
      
      .attr-box label {
        font-size: 9px !important;
      }
      
      .attr-box .value-wrap {
        display: flex !important;
        flex-wrap: nowrap !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 0.1rem !important;
        white-space: nowrap !important;
      }
      
      .attr-box input[type="number"] {
        width: 24px !important;
        font-size: 12px !important;
      }
      
      .attr-dice {
        font-size: 7px !important;
        white-space: nowrap !important;
      }
      
      .attr-box input[type="text"] {
        width: 18px !important;
        font-size: 8px !important;
      }
      
      .vital-box {
        padding: 0.25rem !important;
      }
      
      .vital-box label {
        font-size: 7px !important;
      }
      
      .vital-box input {
        font-size: 12px !important;
      }
      
      .portrait {
        min-height: 100px !important;
      }
      
      .portrait h3 {
        font-size: 11px !important;
      }
      
      .print-box {
        font-size: 10px !important;
        padding: 0.5rem !important;
      }
      
      .grid-top {
        gap: 0.25rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .grid-top .field {
        padding: 0.2rem !important;
        overflow: hidden !important;
      }
      
      .grid-top .field label {
        font-size: 9px !important;
        display: block !important;
        margin-bottom: 0.1rem !important;
      }
      
      .grid-top .field input {
        font-size: 10px !important;
        padding: 0.15rem !important;
        width: 100% !important;
        background: transparent !important;
      }
      
      .row-two-col {
        gap: 0.5rem !important;
      }
      
      .section {
        padding: 0.4rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .section h3 {
        font-size: 11px !important;
      }
      
      .skill-table {
        font-size: 12px !important;
      }
      
      .skill-table th {
        font-size: 12px !important;
      }
      
      .skill-table th,
      .skill-table td {
        padding: 0.15rem !important;
      }
      
      .skill-table input {
        font-size: 12px !important;
      }
      
      .skill-table tbody tr td:first-child {
        padding-left: 1rem !important;
      }
      
      .skill-table tbody tr td:first-child::before {
        font-size: 12px !important;
        top: 0.15rem !important;
        left: 0 !important;
      }
      
      .abilities-list {
        font-size: 12px !important;
        padding-left: 1.2rem !important;
      }
      
      .abilities-list li {
        padding: 0.2rem 0 !important;
        font-size: 12px !important;
        line-height: 1.4 !important;
      }
      
      .abilities-list li::marker {
        font-size: 12px !important;
      }
      
      /* Bonus de race */
      .bonus-race-content {
        font-size: 12px !important;
        padding-left: 1.2rem !important;
      }
      
      .bonus-race-content li {
        font-size: 12px !important;
        padding: 0.2rem 0 !important;
        line-height: 1.4 !important;
      }
      
      .bonus-race-content li::marker {
        font-size: 12px !important;
      }
      
      /* Half sections */
      .half-section {
        padding: 0.4rem !important;
        overflow: hidden !important;
      }
      
      .half-section h3 {
        font-size: 11px !important;
      }
      
      .half-section textarea {
        font-size: 12px !important;
      }
      
      .half-section input[type="file"] {
        font-size: 9px !important;
        max-width: 100% !important;
        overflow: hidden !important;
      }
      
      /* Textarea et notes (inventaire) */
      textarea {
        font-size: 12px !important;
      }
      
      .portrait textarea {
        font-size: 12px !important;
      }
    }
    
    /* Tr√®s petits √©crans (iPhone SE, etc.) */
    @media screen and (max-width: 375px) {
      .wizard-header h1 {
        font-size: 1.1rem !important;
      }
      
      .step-title {
        font-size: 1rem !important;
      }
      
      /* Cartes race/classe sur tr√®s petits √©crans */
      .option-card .option-img,
      .option-card > img {
        width: 35% !important;
        min-width: 35% !important;
        max-width: 35% !important;
      }
      
      .option-card-text-content,
      .option-card .option-content,
      .option-card > div:not(img) {
        width: 65% !important;
        min-width: 65% !important;
        max-width: 65% !important;
        padding: 0.4rem !important;
      }
      
      .option-card .option-name {
        font-size: 12px !important;
      }
      
      .option-card .option-desc {
        font-size: 10px !important;
      }
      
      .option-bonuses,
      .option-maluses {
        font-size: 9px !important;
      }
      
      .option-bonuses li,
      .option-maluses li {
        font-size: 9px !important;
      }
      
      .attributes {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      
      #comp-list {
        grid-template-columns: 1fr !important;
      }
      
      .dice-item {
        width: 42px !important;
        height: 42px !important;
        font-size: 12px !important;
      }
      
      /* Level up - 1 column for characteristics on very small screens */
      .levelup-carac-grid {
        grid-template-columns: 1fr !important;
      }
    }
    
    /* Touch device improvements */
    @media (hover: none) and (pointer: coarse) {
      .option-card,
      .option-checkbox-simple,
      .levelup-option-card,
      .custom-advantage-add,
      .dice-item,
      .attr-item,
      .comp-item,
      button {
        cursor: pointer;
        -webkit-tap-highlight-color: rgba(139, 0, 0, 0.2);
      }
      
      .btn-next,
      .btn-prev,
      .btn-confirm {
        min-height: 48px !important;
      }
    }
    
    @media print {
      .wizard-container, .wizard-separator { display: none !important; }
    }
    /* titre principal */
    .title-row{display:grid;grid-template-columns:repeat(4,1fr);margin-bottom:1rem;}
    .title-box{grid-column:1/span 4;border:2px solid #333;border-radius:1rem;background:#fff;padding:.5rem;text-align:center;font-size:24px;font-weight:bold;color:#8b0000;box-shadow:2px 2px 4px rgba(0,0,0,.1);}
    /* supprimer les fl√®ches +/- des champs number et centrer */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button{ -webkit-appearance:none; margin:0; }
    input[type="number"]{ -moz-appearance:textfield; appearance:textfield; text-align:center; }

    * { box-sizing: border-box; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 0;
      padding: 0;
      background: #fdfdfd;
    }
    .container { max-width: 1000px; margin: 2rem auto; padding: 1rem; position: relative; }

    /* couleurs */
    label, .section h3, .skill-table th { color: #666; }
    .attr-dice { color: #8b0000; }
    input, textarea, .abilities-list, .skill-table input { color: #000; }

    /* grille 4 colonnes principale */
    .attributes-and-vitals {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1rem;
      align-items: stretch;
    }
    .attributes, .vitals, .portrait {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .attributes { grid-column: span 1; gap: 0.5rem; }
    .vitals { grid-column: span 1; gap: 0.5rem; flex: 1; }
    .portrait { grid-column: span 2; flex: 1; }

    /* champs g√©n√©raux (ligne top) */
    .grid-top {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .field {
      border: 2px solid #333;
      border-radius: 1rem;
      padding: 0.5rem;
      background: #fff;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    .field label {
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      display: block;
    }
    .field input {
      width: 100%;
      border: none;
      padding: 0.25rem;
      font-size: 16px;
      text-align: center;
    }

    /* caract√©ristiques */
    .attr-box { flex: 1; border: 2px solid #333; border-radius: 1rem; background: #fff; padding: 0.5rem; box-shadow: 2px 2px 4px rgba(0,0,0,.1); display:flex; flex-direction:column; justify-content:center; align-items:center; }
    .attr-box label { font-weight: bold; font-size: 22px; text-align: center; margin-bottom: 0.25rem; display: block;
      text-align: center;
      margin-bottom: 0.25rem;
      display: block;
    }
    .value-wrap { display: flex; justify-content: center; align-items: center; gap: 0.25rem; }
    .attr-box input[type="number"] { width: 40px; border: none; text-align: center; font-size: 18px; }
    .attr-dice { font-size: 10px; }

    /* vitaux */
    .vital-sep{border:none;border-top:1px solid #666;margin:0.25rem 0;}
    .vital-box {
      border: 2px solid #333;
      border-radius: 1rem;
      background: #fff;
      padding: 0.5rem;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      flex-basis: 0;
    }
    .vital-box label {
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      margin-bottom: 0.25rem;
      display: block;
    }
    .vital-box input { width: 100%; border: none; text-align: center; font-size: 16px; }
    .vital-box:nth-child(1), .vital-box:nth-child(2) { flex: 0 1 40%; }
    .vital-box:nth-child(3) { flex: 0 1 20%; }

    /* portrait / notes */
    .portrait{grid-column:span 2;border:2px solid #333;border-radius:1rem;background:#fff;padding:.75rem;box-shadow:2px 2px 4px rgba(0,0,0,.1);display:flex;flex-direction:column;gap:0.5rem;}
    .portrait h3{margin:0;font-size:22px;text-align:center;color:#666;}
    .portrait textarea{width:100%;border:none;border-radius:0.5rem;padding:0.5rem;background:#fff;font-size:16px;overflow:hidden;resize:none;}

    /* sections pleine largeur (4 col) */
    .section {
      border: 2px solid #333;
      border-radius: 1rem;
      padding: 0.75rem;
      margin-bottom: 1rem;
      background: #fff;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      grid-column: span 4;
    }
    .section h3 { margin-top: 0; font-size: 22px; text-align: center; }
    /* bouton impression */
    .print-box{border:2px solid #333;border-radius:1rem;background:#fff;padding:.75rem;margin-bottom:1rem;grid-column:span 4;text-align:center;font-size:18px;font-weight:bold;color:#666;cursor:pointer;box-shadow:2px 2px 4px rgba(0,0,0,.1);}
    /* rang√©es deux‚Äëcolonnes suppl√©mentaires */
    .row-two-col{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1rem;}
    .half-section{border:2px solid #333;border-radius:1rem;background:#fff;padding:.75rem;box-shadow:2px 2px 4px rgba(0,0,0,.1);grid-column:span 2;}
    .half-section h3{margin-top:0;font-size:22px;text-align:center;color:#666;}
    /* aper√ßu image */
    .image-preview{display:none;width:100%;max-width:100%;height:auto;max-height:100%;border:1px dashed #999;border-radius:0.5rem;object-fit:contain;cursor:pointer;box-sizing:border-box;}

    /* tableau comp√©tences */
    .skill-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .skill-table th, .skill-table td { border-bottom: 1px solid #ccc; padding: 0.25rem; text-align: left; }
    .skill-table th { font-size: 18px; }
    .skill-table th:nth-child(1), .skill-table td:nth-child(1) { width: 50%; }
    .skill-table th:nth-child(2), .skill-table td:nth-child(2) { width: 25%; }
    .skill-table th:nth-child(3), .skill-table td:nth-child(3) { width: 25%; text-align: center; }
    .skill-table input { width: 100%; border: none; font-size: 16px; }
    .skill-table tbody tr td:first-child { position: relative; padding-left: 1.25rem; }
    .skill-table tbody tr td:first-child::before { content: '‚Ä¢'; position: absolute; left: 0; font-size: 16px; line-height: 1; top: 0.3rem; line-height: 1; top: 0.3rem; }

    /* ajuster largeur des textareas des demi‚Äësections */
    .half-section textarea{width:100%;box-sizing:border-box;border:none;border-radius:0.5rem;padding:0.5rem;background:#fff;font-size:16px;overflow:hidden;resize:none;}

    /* listes √† puces √©ditables */
    .abilities-list { list-style-type: disc; padding-left: 1.2rem; margin: 0; font-size: 16px; }
    .abilities-list li{ margin-bottom:0.25rem; border-bottom:1px solid #ccc; padding:0.25rem 0; }
    .abilities-list li:first-child{border-top:1px solid #ccc;}

    @media print {
      /* forcer le zoom 100¬†% et conserver les couleurs/polices du web */
      *{-webkit-print-color-adjust:exact;print-color-adjust:exact;font-size:inherit;}
      html,body{zoom:100%;}
      .container{margin:0;width:1000px;}
      .section, .attributes-and-vitals, .row-two-col, .grid-top, .title-row{break-inside:avoid;page-break-inside:avoid;}
    }
    
    /* auto‚Äëgrow textarea */
    .auto-grow{overflow:hidden;resize:none;width:100%;border:none;font-size:16px;}
  </style>
</head>
<body>
  <!-- ========== WIZARD DE CR√âATION DE PERSONNAGE ========== -->
  <div class="wizard-container" id="wizard-container">
    <div class="wizard-header" id="wizard-intro">
      <h1 class="wizard-title">üé≤ Cr√©ation de Personnage</h1>
      <p class="wizard-subtitle">Bienvenue, aventurier ! Laissez-vous guider dans la cr√©ation de votre personnage.</p>
      <button class="btn-start-wizard" id="btn-start-wizard">D√©marrer la cr√©ation de personnage</button>
      <button class="btn-skip-wizard" id="btn-skip-wizard">Remplir la fiche librement</button>
    </div>

    <div class="wizard-steps" id="wizard-steps">
      <!-- Progress Bar -->
      <div class="wizard-progress">
        <div class="progress-step active" data-step="1">
          <span class="step-number">1</span>
          <span class="step-label">Race</span>
        </div>
        <div class="progress-step" data-step="2">
          <span class="step-number">2</span>
          <span class="step-label">Caract√©ristiques</span>
        </div>
        <div class="progress-step" data-step="3">
          <span class="step-number">3</span>
          <span class="step-label">Classe</span>
        </div>
        <div class="progress-step" data-step="4">
          <span class="step-number">4</span>
          <span class="step-label">Avantage de Classe</span>
        </div>
        <div class="progress-step" data-step="5">
          <span class="step-number">5</span>
          <span class="step-label">Comp√©tences</span>
        </div>
        <div class="progress-step" data-step="6">
          <span class="step-number">6</span>
          <span class="step-label">Avantages</span>
        </div>
        <div class="progress-step" data-step="7">
          <span class="step-number">7</span>
          <span class="step-label">Nom & Stats</span>
        </div>
        <div class="progress-step" data-step="8">
          <span class="step-number">8</span>
          <span class="step-label">Level Up</span>
        </div>
        <div class="progress-step" data-step="9" style="display: none;">
          <span class="step-number">‚úì</span>
          <span class="step-label">Termin√©e</span>
        </div>
      </div>

      <!-- √âtape 1: Choix de la race -->
      <div class="step-content active" data-step="1">
        <h2 class="step-title">Choisissez votre Race</h2>
        <p class="step-description">Votre race d√©termine vos bonus inn√©s et vos aptitudes naturelles.</p>
        <div class="options-grid" id="race-options">
          <!-- G√©n√©r√© par JS -->
        </div>
        <div class="step-navigation">
          <div></div>
          <button class="btn-next" id="btn-next-1" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 2: R√©partition des caract√©ristiques (syst√®me de d√©s) -->
      <div class="step-content" data-step="2">
        <h2 class="step-title">Attribuez vos D√©s aux Caract√©ristiques</h2>
        <p class="step-description">Assignez un d√© unique √† chaque caract√©ristique. La valeur du d√© devient la valeur de la caract√©ristique.</p>
        
        <div class="dice-pool" id="dice-pool">
          <!-- D√©s disponibles g√©n√©r√©s par JS -->
        </div>
        
        <div class="attr-distribute" id="attr-distribute">
          <!-- G√©n√©r√© par JS -->
        </div>
        
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-2">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-2" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 3: Choix de la classe -->
      <div class="step-content" data-step="3">
        <h2 class="step-title">Choisissez votre Classe</h2>
        <p class="step-description">Votre classe d√©finit votre r√¥le et vos capacit√©s en combat.</p>
        <div class="options-grid" id="class-options">
          <!-- G√©n√©r√© par JS -->
        </div>
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-3">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-3" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 4: Choix d'un avantage de classe -->
      <div class="step-content" data-step="4">
        <h2 class="step-title">Choisissez un Avantage de Classe</h2>
        <p class="step-description">S√©lectionnez l'avantage principal de votre classe.</p>
        <div class="options-grid-4col" id="primary-advantage-options">
          <!-- G√©n√©r√© par JS -->
        </div>
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-4">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-4" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 5: R√©partition des comp√©tences -->
      <div class="step-content" data-step="5">
        <h2 class="step-title">R√©partissez vos Comp√©tences</h2>
        <p class="step-description">Distribuez 12 points parmi les comp√©tences disponibles.</p>
        <div class="points-counter">
          Points restants : <span class="remaining" id="comp-points-remaining">12</span>
        </div>
        <div class="comp-distribute" id="comp-distribute">
          <!-- G√©n√©r√© par JS -->
        </div>
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-5">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-5" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 6: Choix de 3 avantages secondaires -->
      <div class="step-content" data-step="6">
        <h2 class="step-title">Choisissez 3 Avantages Secondaires</h2>
        <p class="step-description">S√©lectionnez 3 avantages parmi ceux de votre classe.</p>
        <div class="selection-count">S√©lectionn√©s : <strong id="secondary-count">0</strong> / 3</div>
        <div id="secondary-advantage-options">
          <!-- G√©n√©r√© par JS -->
        </div>
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-6">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-6" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 7: Nom du personnage et calcul des stats -->
      <div class="step-content" data-step="7">
        <h2 class="step-title">Nommez votre Personnage</h2>
        <p class="step-description">Donnez un nom √† votre personnage, choisissez son alignement et validez le calcul de ses statistiques vitales.</p>
        
        <div class="name-alignment-grid">
          <div class="name-input-section">
            <label for="wizard-name" style="display:block; font-weight:bold; font-size:16px; color:#666; margin-bottom:0.5rem;">Nom du Personnage</label>
            <input type="text" id="wizard-name" placeholder="Entrez le nom de votre personnage..." style="width:100%; padding:0.75rem; font-size:18px; border:2px solid #ddd; border-radius:0.5rem; text-align:center;">
          </div>
          <div class="alignment-input-section">
            <label for="wizard-alignment" style="display:block; font-weight:bold; font-size:16px; color:#666; margin-bottom:0.5rem;">Alignement</label>
            <select id="wizard-alignment" style="width:100%; padding:0.75rem; font-size:16px; border:2px solid #ddd; border-radius:0.5rem; text-align:center; cursor:pointer;">
              <option value="">-- Choisir --</option>
              <option value="Loyal Bon">Loyal Bon</option>
              <option value="Loyal Neutre">Loyal Neutre</option>
              <option value="Loyal Mauvais">Loyal Mauvais</option>
              <option value="Neutre Bon">Neutre Bon</option>
              <option value="Neutre Neutre">Neutre Neutre</option>
              <option value="Neutre Mauvais">Neutre Mauvais</option>
              <option value="Chaotique Bon">Chaotique Bon</option>
              <option value="Chaotique Neutre">Chaotique Neutre</option>
              <option value="Chaotique Mauvais">Chaotique Mauvais</option>
            </select>
          </div>
        </div>
        
        <div class="stats-summary" style="background:#f8f9fa; border-radius:0.75rem; padding:1rem; margin-bottom:1rem;">
          <h4 style="margin:0 0 1rem 0; color:#8b0000; text-align:center;">üìä R√©capitulatif des Statistiques</h4>
          <div class="stats-recap-grid">
            <div class="stat-box" style="background:#fff; padding:0.75rem; border-radius:0.5rem; text-align:center; border:2px solid #27ae60;">
              <div style="font-size:14px; color:#666;">Points de Vie (PV)</div>
              <div style="font-size:28px; font-weight:bold; color:#27ae60;" id="calculated-pv">--</div>
              <div style="font-size:11px; color:#999;" id="pv-formula">FOR√ó2 + INT√ó2 + 10 + Niveau + Bonus</div>
            </div>
            <div class="stat-box" style="background:#fff; padding:0.75rem; border-radius:0.5rem; text-align:center; border:2px solid #3498db;">
              <div style="font-size:14px; color:#666;">Points de Fatalit√© (PF)</div>
              <div style="font-size:28px; font-weight:bold; color:#3498db;" id="calculated-pf">--</div>
              <div style="font-size:11px; color:#999;" id="pf-formula">PV + Bonus</div>
            </div>
          </div>
          <div style="margin-top:1rem; padding:0.75rem; background:#fff5f5; border-radius:0.5rem; font-size:13px; color:#666;" id="stats-details">
            <!-- D√©tails du calcul -->
          </div>
        </div>
        
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-7">‚Üê Pr√©c√©dent</button>
          <button class="btn-next" id="btn-next-7" disabled>Suivant ‚Üí</button>
        </div>
      </div>

      <!-- √âtape 8: Level Up -->
      <div class="step-content" data-step="8">
        <h2 class="step-title">Am√©liorations de Niveau (Level Up)</h2>
        <p class="step-description">Chaque Level Up vous donne <strong>10 points de cr√©ation</strong> √† d√©penser. Choisissez vos am√©liorations ci-dessous.</p>
        
        <div class="levelup-controls">
          <label style="font-weight:bold; color:#666;">Nombre de Level Up :</label>
          <div style="display:flex; align-items:center; gap:0.5rem;">
            <button id="levelup-minus" class="levelup-btn" style="width:36px; height:36px; font-size:20px; border:2px solid #8b0000; background:#fff; color:#8b0000; border-radius:0.25rem; cursor:pointer;">‚àí</button>
            <input type="number" id="levelup-count" min="0" max="10" value="0" style="width:60px; text-align:center; font-size:18px; font-weight:bold; border:2px solid #ddd; border-radius:0.25rem; padding:0.25rem;">
            <button id="levelup-plus" class="levelup-btn" style="width:36px; height:36px; font-size:20px; border:2px solid #8b0000; background:#8b0000; color:#fff; border-radius:0.25rem; cursor:pointer;">+</button>
          </div>
          <span id="levelup-total-points" style="font-size:18px; font-weight:bold; color:#27ae60;">= 0 points</span>
        </div>
        
        <div id="level-up-container">
          <!-- G√©n√©r√© par JS -->
        </div>
        
        <div class="step-navigation">
          <button class="btn-prev" id="btn-prev-8">‚Üê Pr√©c√©dent</button>
          <button class="btn-confirm" id="btn-confirm">‚úì Confirmer et finaliser la fiche</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wizard-separator" id="wizard-separator" style="display: none;">
    <span>üìú Votre Fiche de Personnage</span>
  </div>

  <div class="container" id="character-sheet">
    <!-- Titre centr√© 2 colonnes -->
    <div class="title-row"><div class="title-box">GA√èA 2¬†-¬†FICHE¬†DE¬†PERSONNAGE</div></div>
    <!-- Ligne sup√©rieure -->
    <div class="grid-top">
      <div class="field"><label for="name">Nom du Personnage</label><input id="name" /></div>
      <div class="field"><label for="level">Niveau</label><input id="level" type="number" min="1" value="1" /></div>
      <div class="field"><label for="race">Race</label><input id="race" /></div>
      <div class="field"><label for="class">Classe</label><input id="class" /></div>
    </div>

    <!-- Grille principale -->
    <div class="attributes-and-vitals">
      <!-- Caract√©ristiques (col 1) -->
      <div class="attributes">
        <div class="attr-box"><label for="force">Force</label><div class="value-wrap"><input id="force" type="number" placeholder="10" value="10" /><span class="attr-dice" id="force-dice"></span><input type="text" placeholder="+0" style="width:30px;text-align:center;border:none;font-size:18px;" /></div></div>
        <div class="attr-box"><label for="dex">Dext√©rit√©</label><div class="value-wrap"><input id="dex" type="number" placeholder="10" value="10" /><span class="attr-dice" id="dex-dice"></span><input type="text" placeholder="+0" style="width:30px;text-align:center;border:none;font-size:18px;" /></div></div>
        <div class="attr-box"><label for="emp">Empathie</label><div class="value-wrap"><input id="emp" type="number" placeholder="10" value="10" /><span class="attr-dice" id="emp-dice"></span><input type="text" placeholder="+0" style="width:30px;text-align:center;border:none;font-size:18px;" /></div></div>
        <div class="attr-box"><label for="sag">Sagesse</label><div class="value-wrap"><input id="sag" type="number" placeholder="10" value="10" /><span class="attr-dice" id="sag-dice"></span><input type="text" placeholder="+0" style="width:30px;text-align:center;border:none;font-size:18px;" /></div></div>
        <div class="attr-box"><label for="int">Intelligence</label><div class="value-wrap"><input id="int" type="number" placeholder="10" value="10" /><span class="attr-dice" id="int-dice"></span><input type="text" placeholder="+0" style="width:30px;text-align:center;border:none;font-size:18px;" /></div></div>
      </div>

      <!-- PV / PF / Alignement (col 2) -->
      <div class="vitals">
        <div class="vital-box">
          <label>PV</label>
          <div style="display:flex;align-items:center;justify-content:center;gap:0.25rem;margin-bottom:0.25rem;">
            <input id="pv-max" type="number" placeholder="Max" style="width:50px;" />
            <span style="font-size:14px;color:#666;">+</span>
            <span style="font-size:14px;color:#666;margin-left:0.25rem;">(</span>
            <input id="pv-temp" type="number" placeholder="0" style="width:40px;" />
            <span style="font-size:14px;color:#666;">)</span>
          </div>
          <hr class="vital-sep" />
          <input id="pv-current" type="number" placeholder="Actuel" />
        </div>
        <div class="vital-box"><label>PF</label><input id="pf-max" type="number" placeholder="Max" /><hr class="vital-sep" /><input id="pf-current" type="number" placeholder="Actuel" /></div>
        <div class="vital-box"><label>Alignement</label><input id="alignement" type="text" placeholder="" /></div>
      </div>

      <!-- Notes / portrait (cols 3-4) -->
      <div class="portrait">
        <h3>Notes ‚Äì Qu√™tes ‚Äì √âquipements</h3>
        <textarea class="auto-grow" rows="1"></textarea>
      </div>
    </div>

    <!-- Bonus de race -->
    <div class="section">
      <h3>Bonus de race</h3>
      <ul class="abilities-list" contenteditable="true"><li></li><li></li><li></li></ul>
    </div>

    <!-- Comp√©tences -->
    <div class="section">
      <h3>Comp√©tences</h3>
      <table class="skill-table">
        <thead>
          <tr><th>Nom</th><th>Attribut</th><th>Bonus</th></tr>
        </thead>
        <tbody>
          <tr><td><input /></td><td><input placeholder="FOR" /></td><td><input type="number" placeholder="+0" /></td></tr>
          <tr><td><input /></td><td><input placeholder="FOR" /></td><td><input type="number" placeholder="+0" /></td></tr>
          <tr><td><input /></td><td><input placeholder="DEX" /></td><td><input type="number" placeholder="+0" /></td></tr>
          <tr><td><input /></td><td><input placeholder="DEX" /></td><td><input type="number" placeholder="+0" /></td></tr>
          <tr><td><input /></td><td><input placeholder="SAG" /></td><td><input type="number" placeholder="+0" /></td></tr>
          <tr><td><input /></td><td><input placeholder="SAG" /></td><td><input type="number" placeholder="+0" /></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Capacit√©s -->
    <div class="section">
      <h3>Avantages / Capacit√©s</h3>
      <ul class="abilities-list" contenteditable="true"><li></li><li></li><li></li></ul>
    </div>

    <!-- Description + empty box -->
    <div class="row-two-col">
      <div class="half-section">
        <h3>Description Physique</h3>
        <textarea class="auto-grow" rows="1"></textarea>
      </div>
      <div class="half-section">
        <h3>Visuel</h3>
        <input type="file" id="avatar-input" accept="image/*" style="display:block;margin-bottom:.5rem;">
        <img id="avatar-preview" class="image-preview" src="" alt="Aper√ßu du personnage" />
      </div>
    </div>

    <!-- Histoire + Relations -->
    <div class="row-two-col">
      <div class="half-section">
        <h3>Histoire</h3>
        <textarea class="auto-grow" rows="1"></textarea>
      </div>
      <div class="half-section">
        <h3>Relations¬†‚Äì Alli√©s et Enemies</h3>
        <textarea class="auto-grow" rows="1"></textarea>
      </div>
    </div>

    <!-- Export / Impression -->
    <div class="print-box" id="print-btn">Exporter au format PDF ‚Äì Imprimer la Fiche de Personnage</div>
  </div>

  <script>
    function getDie(val) {
      if (val <= 4) return 'D4';
      if (val <= 6) return 'D6';
      if (val <= 8) return 'D8';
      if (val <= 10) return 'D10';
      return 'D12';
    }

    document.querySelectorAll('.attr-box').forEach(box => {
      const numInput = box.querySelector('input[type="number"]');
      const diceSpan = box.querySelector('.attr-dice');
      const update = () => {
        const v = parseInt(numInput.value, 10) || 0;
        diceSpan.textContent = `( ${getDie(v)} )`;
      };
      numInput.addEventListener('input', update);
      update();
    });
    // Ajout de lignes dans Comp√©tences avec Entr√©e
    const skillsBody = document.querySelector('.skill-table tbody');
    skillsBody.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const currentRow = e.target.closest('tr');
        if (!currentRow) return;
        const newRow = currentRow.cloneNode(true);
        newRow.querySelectorAll('input').forEach(inp => inp.value = '');
        currentRow.after(newRow);
        newRow.querySelector('input').focus();
      }
    });
    // Suppression d‚Äôune ligne vide avec Backspace dans Comp√©tences
    skillsBody.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && e.target.value === '') {
        const row = e.target.closest('tr');
        if (row && row.parentElement.children.length > 1) {
          e.preventDefault();
          const prev = row.previousElementSibling ? row.previousElementSibling.querySelector('input') : null;
          row.remove();
          if (prev) prev.focus();
        }
      }
    });

    // Suppression d‚Äôun <li> vide avec Backspace dans Bonus de race & Capacit√©s
    document.querySelectorAll('.abilities-list').forEach(list => {
      list.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace') {
          const sel = window.getSelection();
          if (!sel || !sel.anchorNode) return;
          const li = sel.anchorNode.closest('li');
          if (li && li.textContent.trim() === '' && list.children.length > 1) {
            e.preventDefault();
            const prev = li.previousElementSibling || li.nextElementSibling;
            const range = document.createRange();
            li.remove();
            if (prev) {
              range.selectNodeContents(prev);
              range.collapse(false);
              sel.removeAllRanges();
              sel.addRange(range);
            }
          }
        }
      });
    });
    // Bouton impression
    const printBtn=document.getElementById('print-btn');
    if(printBtn){printBtn.addEventListener('click',()=>window.print());}

    // Chargement de l'image personnage + toggle bouton
    const fileInput = document.getElementById('avatar-input');
    const previewImg = document.getElementById('avatar-preview');

    if(fileInput){
      // cliquer sur l‚Äôimage rouvre le s√©lecteur
      previewImg.addEventListener('click', ()=> fileInput.click());

      fileInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if(file){
          const reader = new FileReader();
          reader.onload = ev => {
            previewImg.src = ev.target.result;
            previewImg.style.display = 'block';
            fileInput.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // auto-grow textarea
    document.querySelectorAll('.auto-grow').forEach(area=>{
      const resize=()=>{area.style.height='auto';area.style.height=area.scrollHeight+'px';};
      area.addEventListener('input',resize);
      resize();
    });

    // ========== WIZARD DE CR√âATION ==========
    (function() {
      // Donn√©es de cr√©ation int√©gr√©es directement (pour fonctionner sans serveur)
      const characterData = {
        "races": [
          {"id":"humain","name":"Humain","description":"Esp√®ce ¬´ dominante ¬ª, r√©put√©e pour son adaptabilit√© et son sens des affaires. Souvent ouverts aux nouveaut√©s, les humains sont une esp√®ce essentiellement citadine.","bonuses":["Comp√©tent : +1 point de cr√©ation par Niveau (Niveau 1 compris)","Adaptable : peut apprendre un avantage racial d'une autre race en trouvant un Ma√Ætre et en y consacrant du temps"],"maluses":["Complex√© : choisir une race envers laquelle le personnage est raciste ou haineux. Le Charisme compte comme n√©gatif lors des interactions avec cette race"]},
          {"id":"elfe","name":"Elfe","description":"Sveltes, bons grimpeurs et amis des for√™ts, les elfes ont une peau blanche verd√¢tre et sont assez proches physiquement des humains, √† l'exception de leurs traits distinctifs.","bonuses":["Vision dans le noir","Corps elfique : +Niveau aux soins re√ßus et +Niveau/2 sur les r√©g√©n√©rations","Constitution elfique : PV = 10 + Int + For"],"maluses":[]},
          {"id":"orc","name":"Orc","description":"Souvent plus athl√©tiques et coriaces, les orcs vivent dans une soci√©t√© clanique patriarcale. Ils sont connus pour leur soif d'aventure et leur go√ªt de l'adr√©naline, d√ª √† leur esp√©rance de vie relativement courte. L'id√©e est de vivre un maximum d'exp√©riences exceptionnelles. Le sens de l'honneur est appr√©ci√© chez ces peaux vertes, m√™me si eux-m√™mes ne le sont pas n√©cessairement.","bonuses":["Athl'Orc : +1 Force","Berz'Orc : ignore 1 blessure en combat"],"maluses":["Hon'Orc : doit r√©ussir un jet de Volont√© pour ne pas s'√©nerver, sinon perte de Sant√© Mentale"]},
          {"id":"nain","name":"Nain","description":"√âvidemment de petite taille, mais pas aussi bourrus qu'on le pense, les nains sont capables de boire des mixtures extraordinairement fortes. L'artisanat est bien s√ªr leur sp√©cialit√©, et l'argent est toujours appr√©ci√© !","bonuses":["Artisa'Nain : commence avec une arme dot√©e d'une rune ancestrale (+1 magique) qui aide selon le domaine d'expertise de l'anc√™tre. Peut √™tre transf√©r√©e √† un autre objet pour 3 actions","Gn√¥le naine : flasque de gn√¥le naine (15 gorg√©es). 1 gorg√©e = 5 PV et 5 PF, 1 gorg√©e par action, +5 R√©sistance √† l'alcool"],"maluses":["Sang de pierre : ‚àíForce PV rendus par les soins et ‚àíForce/2 sur les r√©g√©n√©rations avec des moyens non-nains"]},
          {"id":"troll","name":"Troll","description":"Le troll est une force de la nature, et de ce fait tr√®s connect√© √† celle-ci. G√©n√©ralement tr√®s grands et arborant des teintes proches des arbres, ils sont souvent tourn√©s vers la po√©sie et le pacifisme. Cependant, la vision la plus terrifiante qui soit serait, selon les rumeurs‚Ä¶ un village troll en col√®re.","bonuses":["Force de la nature : +1 Force, +2 suppl√©mentaires quand il agit contre quelqu'un qui l'√©nerve","Aura de con-Troll : camouflage bas√© sur la Force en milieu naturel"],"maluses":["Calme de la montagne : fondamentalement pacifiste (sauf s'il est hors de lui ou riposte). ‚àí5 √† tous les tests de combat tant qu'il n'est pas √©nerv√©, sinon perte de Sant√© Mentale"]},
          {"id":"nymphe","name":"Nymphe","description":"Port√©es sur les arts, t√©l√©pathes et muettes, les nymphes sont particuli√®rement connues pour leur capacit√© √† transmettre des √©motions et maintenir le moral de leur entourage. Elles vivent g√©n√©ralement entre elles et tirent au hasard leur repr√©sentant politique. Elles naissent dans un arbre de vie gracile et clair, √† leur image, et sont tr√®s li√©es √† leur diablotin rouge ail√© qui les accompagne tr√®s souvent.","bonuses":["T√©l√©pathe : communique par t√©l√©pathie, images, etc. La nymphe √©met seulement ; on ne peut lui r√©pondre par le m√™me moyen","Familier : poss√®de un petit diablotin volant comme familier"],"maluses":["Familier fragile : le familier est faible et tr√®s attach√©. 2 tares mentales si le familier est perdu"]},
          {"id":"sylphe","name":"Sylphe","description":"D'une taille moyenne inf√©rieure aux nains, mais h√©las bien moins corpulents, les sylphes ont une peau oliv√¢tre et des ailes √©voquant celles des libellules. Ils n'ont pas de soci√©t√© propre et vivent parmi les autres races au gr√© de leurs voyages. D'un naturel espi√®gle, leur volont√© est de fer et leur sourire d'une douceur sans pareille. Petite anecdote : personne n'a jamais trouv√© le palais l√©gendaire de ces √™tres, et ce sont les hommes qui portent les enfants.","bonuses":["Ailes : peut voler","Pouvoir de l'Amiti√© : 1 fois par sc√©nario, le sylphe peut puiser dans les PF du groupe pour un jet"],"maluses":["‚àí1 Force"]},
          {"id":"vampire","name":"Vampire","description":"Issus d'une transformation par un futur pair, les vampires ont toujours v√©cu incognito parmi les autres races. Ils se sont toujours faits discrets, avec une hi√©rarchie tr√®s rigide r√©gie par les plus puissants ‚Äì h√©las disparus pour la plupart depuis la nuit de la catastrophe. Les vampires sortent d√©sormais des ombres pour se m√™ler √† la population, encourag√©s par le fait que les autres races se c√¥toient.","bonuses":["Veinard : le vampire recouvre un objet de ses veines et r√©cup√®re la moiti√© des PV inflig√©s avec","+1 Charisme"],"maluses":["Vuln√©rable au Feu et √† la Lumi√®re Vive : +50% d'effets subis"]},
          {"id":"nezen","name":"Nezen (Homme-Rat)","description":"Connus pour √™tre la lie de la soci√©t√©, les hommes-rats ont effectivement eu le temps de s'adapter √† ce genre de vie, mais certains tentent malgr√© tout de s'√©lever. Que ce soit √† cause de leurs habitudes ou de la vision qu'on a d'eux, ces √™tres sont des survivalistes hors pair.","bonuses":["Bouffe-tout : peut manger n'importe quoi, immunis√© aux maladies, poisons, etc.","Contact Bas-Fonds : chance d'avoir une connaissance pouvant aider dans la basse soci√©t√© (bien vu dans les bas-fonds)"],"maluses":["Mauvaise r√©putation : mal vu en milieu ais√©"]},
          {"id":"artificiel","name":"Artificiel","description":"Golem, objet m√©canique ou magique : ce groupe rassemble toutes les cr√©ations non organiques.","bonuses":["Insomniaque / Hyperactif : +1 action inter-s√©ance","Corps de m√©tal : porteur sain de toute toxine"],"maluses":["Compatibilit√© m√©canique : les soins et r√©g√©n√©rations ne fonctionnent pas sur le golem. Il doit passer du temps entre les s√©ances pour r√©cup√©rer les PV perdus"]},
          {"id":"monstruosite","name":"Monstruosit√©","description":"Golem de chair ou structure magique cr√©√©e √† partir de mati√®re organique : ce groupe rassemble toutes les cr√©ations organiques.","bonuses":["Avantage 1 : √† d√©terminer avec le MJ","Avantage 2 : √† d√©terminer avec le MJ"],"maluses":["Apparence monstrueuse : ‚àí5 aux interactions sociales bas√©es sur le physique"]},
          {"id":"hybride","name":"Hybride (Aviaire / F√©roce / Agile)","description":"L'hybridation peut avoir diverses origines : croisement, manipulation g√©n√©tique ou descendance d'hybrides. Les hybrides ont longtemps v√©cu cach√©s, consid√©r√©s comme des monstres par les humains, mais sortent aujourd'hui de leur trou.","bonuses":["+1 Dext√©rit√© ou Force (au choix)","Animalisme : 2 traits mineurs de l'animal associ√©"],"maluses":["Fight or Flight : choisir √† la cr√©ation. En situation de conflit : si ¬´ Flight ¬ª, doit r√©ussir un jet de Volont√© ou s'enfuir (sinon perte de SM). Si ¬´ Fight ¬ª, doit r√©ussir un jet de Volont√© ou attaquer (sinon perte de SM)"]},
          {"id":"garou","name":"Garou","description":"Vivant parmi les hommes √† l'instar des vampires, les garous prennent leur essor en ce moment. Ils sont connus pour appr√©cier la bonne chair (dans tous les sens du terme), les mati√®res animales et le frisson du combat. Ils ont cependant des superstitions qui les bloquent parfois. Contrairement aux pr√©jug√©s, ils peuvent se transformer √† volont√©, et il est tr√®s difficile de s'en faire un ennemi (mais facile de se faire l'ennemi de tous ceux du secteur).","bonuses":["Forme de combat : +Force/2 et +Dex/2, co√ªte Niveau PF par tour","Solidarit√© de la meute : entraide naturelle avec les autres garous"],"maluses":["V≈ìu de pauvret√© : gagne la moiti√© de l'argent suite aux qu√™tes (d√©pense vite)"]},
          {"id":"goule","name":"Goule","description":"D'apparence repoussante (t√™te √©voquant des √™tres troglodytes, sabots, etc.), les goules ont trouv√© jadis un moyen de passer inaper√ßues‚Ä¶ la m√©tamorphose ! Elles √©taient √† l'origine une cr√©ation vampirique, mais certaines ont r√©ussi √† √©chapper √† leurs premiers ma√Ætres pour s'organiser. Dot√©es d'une grande adaptabilit√© mais aussi d'une forte allergie √† la flore, elles ont r√©ussi √† se faire une place discr√®te dans le monde.","bonuses":["Aruspice des entrailles : permet de lire une partie de l'avenir dans des entrailles","Formes suppl√©mentaires : vieillard ou chien. 5 PF pour changer de forme, passage possible de l'une √† l'autre sans repasser par la forme de base. Revenir √† la forme de base est gratuit"],"maluses":["Allergie aux plantes : allergie SUPRA s√©v√®re, m√™me au simple contact"]},
          {"id":"demon","name":"D√©mon","description":"Issus du plan d√©moniaque, avec leurs propres dieux et chefs (souvent les m√™mes) et dot√©s de capacit√©s colossales‚Ä¶ chez eux. Les d√©mons viennent de temps en temps rendre visite √† notre monde, amicalement ou non. Mais gardez quand m√™me un ≈ìil sur eux, surtout ceux qui sont sympathiques. Ils arborent souvent des couleurs chaudes ou sombres avec divers attributs rappelant leur plan d'origine.","bonuses":["Cuir √©pais : +Niveau RD magique","D√©vou√© au chaos : choisir un Vice √† la cr√©ation. 1 fois par sc√©nario, √™tre dans un lieu o√π l'on s'adonne audit vice donne 1 point d'Espoir. Pousser quelqu'un √† s'y adonner donne 1 point d'Anarchy"],"maluses":["Haine / Rivalit√© avec les Anges et les Dieux : perte de Sant√© Mentale pour se retenir"]},
          {"id":"ange","name":"Ange","description":"Issus du plan ang√©lique, avec leurs propres dieux et chefs et dot√©s de capacit√©s colossales‚Ä¶ chez eux. Connus pour leurs bienfaits selon les superstitions. Physiquement, ils prennent une apparence qui leur pla√Æt lors de leur premi√®re arriv√©e dans notre monde. Particularit√© : les ailes d'√©nergie dans leur dos ne changent jamais.","bonuses":["Forme d'√©nergie : peut devenir intangible 1 fois par s√©ance","Affinit√© avec les artefacts : peut identifier un objet non magique et l'utiliser avec +2"],"maluses":["H√©mophilie magique : perd la moiti√© des PV perdus en PF √©galement"]},
          {"id":"gobelin","name":"Gobelin","description":"Petits, pas aussi m√©chants qu'on veut bien le croire, mais surtout d√©bordant d'√©nergie et souvent d'id√©es plus ou moins bonnes. Le gobelin est un humano√Øde de couleur gris verd√¢tre. Ils vivent souvent entre eux et sont parfois consid√©r√©s comme des animaux plut√¥t que comme des citoyens, ce qui a tendance √† les vexer.","bonuses":["Mains agiles : +1 Dext√©rit√©","Boum ? Paboum ? : 1 objet peut toujours devenir une bombe (active au contact, Niveau D6 d√©g√¢ts)","Shonen Junk : ¬´ Rien d'impossible √† un gobelin ! ¬ª"],"maluses":[]},
          {"id":"lutin","name":"Lutin","description":"Petit humano√Øde bedonnant et barbu quel que soit son sexe, le lutin est une vision f√©erique quand on le rencontre. Cependant, on d√©chante vite devant le l√©gendaire caract√®re acari√¢tre de l'esp√®ce. Il existe √©videmment des lutins parfaitement aimables, mais ils ne sont pas l√©gion. Ils se d√©finissent comme un peuple gardien de nombreux secrets, guides spirituels vers d'impossibles d√©couvertes, et dot√©s d'un bon flair pour les bonnes affaires. Connus pour leurs noms interminables : l'une des pires horreurs est de demander √† un lutin son nom complet plut√¥t que son diminutif.","bonuses":["Chance du lutin : 1 relance par session","Inventaire de RPG : le lutin peut faire appara√Ætre une grande bo√Æte nomm√©e ¬´ Inventaire ¬ª o√π il stocke √† l'infini ses objets"],"maluses":["Secret et √©nigmatique : cachotier, aime faire m√©riter toute information avec une √©nigme, ce qui le rend insupportable. ‚àí2 Social"]},
          {"id":"daedroth","name":"Daedroth (Homme-Reptile)","description":"Homme-serpent, homme-dragon, homme-l√©zard‚Ä¶ Nombreux noms pour une seule race qui, au nez et √† la barbe des autres, a d√©cid√© de s'appeler Daedroth. √Ä l'origine vivant dans des tribus tr√®s ferm√©es sur une √Æle √† l'√©cart du monde, ils ont d√©cid√© de s'ouvrir aux autres apr√®s les √©v√©nements r√©cents. La famille est extr√™mement importante pour ces √™tres, qui ne parlent d'ailleurs jamais d'eux √† la premi√®re personne (ils pr√©f√®rent omettre le pronom : ¬´ vais bien ¬ª au lieu de ¬´ je vais bien ¬ª). Ce peuple garde un secret : ils savent faire pousser des pierres et des gemmes.","bonuses":["Sang cicatrisant : r√©g√©n√®re Niveau PV par tour","R√©sistance Chaleur / Feu : 50%"],"maluses":["‚àí1 Intelligence"]},
          {"id":"zombie","name":"Zombie","description":"Un rendez-vous manqu√© avec la mort, un rappel par un n√©cromancien ou un cong√© accord√© par la faucheuse‚Ä¶ Il s'av√®re que parfois, les morts ne le restent pas. Leur biologie ne fonctionne plus vraiment, mais tant qu'il y a de la vie, il y a de l'espoir.","bonuses":["Thriller : choisit un leader et fait la m√™me chose que lui ce tour-ci (m√™me jet, m√™me comp√©tence, seule la caract√©ristique change)","Lenteur cin√©matographique : +Niveau en Initiative"],"maluses":["Pourriture sur patte : ‚àí5 aux jets de discr√©tion li√©s √† l'odeur"]}
        ],
        "classes": [
          {"id":"rodeur","name":"R√¥deur","description":"Ma√Ætre des √©tendues sauvages, le r√¥deur excelle dans la survie en milieu naturel, le pistage et le combat √† distance.","avantages":[{"id":"langage-foret","name":"Langage de la for√™t","description":"Permet de conna√Ætre la situation globale du milieu (dangers, pr√©sences, etc.)"},{"id":"signalisation","name":"Signalisation des r√¥deurs","description":"Connaissance des signes et marques laiss√©s par les r√¥deurs"},{"id":"pas-loup","name":"Pas de loup","description":"+Niveau/2 en Discr√©tion en milieu naturel"},{"id":"depecage","name":"D√©pe√ßage avanc√©","description":"Permet d'obtenir des composants plus rares sur les cr√©atures"},{"id":"refuges","name":"Refuges des r√¥deurs","description":"Connaissance des refuges secrets des r√¥deurs"},{"id":"vision-aigle","name":"Vision d'aigle","description":"+Niveau/2 en Perception"},{"id":"compagnon-animal","name":"Compagnon animal","description":"Poss√®de un compagnon animal fid√®le"},{"id":"tir-precis","name":"Tir pr√©cis","description":"Peut relancer les d√©s de d√©g√¢ts"},{"id":"tir-rapide","name":"Tir rapide","description":"Peut attaquer plus fr√©quemment √† distance"},{"id":"acrobatie","name":"Acrobatie","description":"Ma√Ætrise des mouvements acrobatiques"}]},
          {"id":"guerrier","name":"Guerrier","description":"Combattant aguerri et polyvalent, le guerrier ma√Ætrise l'art de la guerre sous toutes ses formes.","avantages":[{"id":"parade-reactive","name":"Parade r√©active","description":"1 d√©fense suppl√©mentaire sans malus"},{"id":"botte","name":"Botte","description":"+Niveau en attaque, 1 fois par combat"},{"id":"arme-favorite","name":"Arme favorite","description":"+Niveau/2 avec un type d'arme choisi"},{"id":"arme-nommee","name":"Arme nomm√©e","description":"+Niveau/2 avec une arme sp√©cifique"},{"id":"charge","name":"Charge","description":"Permet de renverser ou choquer l'adversaire"},{"id":"interception","name":"Interception","description":"D√©fend une attaque destin√©e √† un alli√©, 1 fois par combat"},{"id":"coup-assommant","name":"Coup assommant","description":"Peut assommer un adversaire"},{"id":"briser","name":"Briser","description":"D√©g√¢ts accrus sur l'√©quipement et les armes adverses"},{"id":"organisation-combat","name":"Organisation du combat","description":"Jet tactique par combat permettant de repositionner les alli√©s"},{"id":"connaissance-armure","name":"Connaissance d'armure","description":"+Niveau/2 en D√©fense et RD, +Niveau/2 en attaque contre armure similaire"}]},
          {"id":"maitre-arme","name":"Ma√Ætre d'arme","description":"Virtuose du combat rapproch√©, le ma√Ætre d'arme a perfectionn√© son art jusqu'√† l'excellence.","avantages":[{"id":"botte-secrete","name":"Botte secr√®te","description":"Attaque sans d√©g√¢ts mais l'ennemi a ‚àíNiveau+2 en D√©fense jusqu'√† la fin du prochain tour"},{"id":"feinte","name":"Feinte","description":"‚àíNiveau/2 en attaque, +Niveau/2 en d√©g√¢ts"},{"id":"point-faible","name":"Point faible","description":"‚àí5 en attaque mais ignore l'armure"},{"id":"ecarter-soie","name":"√âcarter la soie","description":"D√©g√¢ts /2 continus, arme plant√©e : ennemi ‚àí5 atk/def, +10 pour attaquer le personnage"},{"id":"frappe-sang-lie","name":"Frappe du Sang-Li√©","description":"Sacrifie PF ou PV pour augmenter les d√©g√¢ts d'autant (PV) ou moiti√© (PF)"},{"id":"demonstration","name":"D√©monstration","description":"Man≈ìuvre offensive pour intimider"},{"id":"coup-bas","name":"Coup bas","description":"1 action par combat, +Niveau/2 en Initiative"},{"id":"repliques-percutantes","name":"R√©pliques percutantes","description":"Ajouter Baratin √† r√©partir entre attaque et d√©g√¢ts"},{"id":"provocation-masse","name":"Provocation de masse","description":"Attire l'attention de plusieurs ennemis"},{"id":"perfection-etincelante","name":"Perfection √©tincelante","description":"Peut ajouter sa Force aux jets sociaux"}]},
          {"id":"moine","name":"Moine","description":"Artiste martial ayant atteint la ma√Ætrise de son corps et de son esprit.","avantages":[{"id":"petit-papa-baston","name":"Petit Papa Baston","description":"+Niveau √† r√©partir entre attaque et d√©g√¢ts contondants mains nues, 3 PF/round"},{"id":"frappe-fulgurante","name":"Frappe fulgurante","description":"1 fois par combat, attaque instantan√©e"},{"id":"esprit-allie","name":"Esprit alli√©","description":"1 action, +Niveau/2 aux actions alli√©es pendant 2 rounds"},{"id":"chakra","name":"Chakra","description":"Actions ninjaesques et techniques sp√©ciales"},{"id":"poing-acier","name":"Poing d'acier","description":"Peut parer √† mains nues"},{"id":"enchainement","name":"Encha√Ænement","description":"Si diff√©rence de 5+, attaque suppl√©mentaire"},{"id":"queue-dragon","name":"Queue du dragon","description":"Attaque de zone au corps √† corps"},{"id":"fureur-anciens","name":"Fureur des Anciens","description":"+Niveau/2 aux d√©g√¢ts √† mains nues"},{"id":"saut-salvateur","name":"Saut salvateur","description":"D√©sengagement gratuit"},{"id":"meditation","name":"M√©ditation","description":"1 relance par session"}]},
          {"id":"artiste","name":"Artiste","description":"Performer charismatique dont le talent transcende le simple divertissement.","avantages":[{"id":"rock-star","name":"Rock Star","description":"Poss√®de un groupuscule de fans d√©vou√©s"},{"id":"voie-ange","name":"Voie d'ange","description":"+Niveau/2 aux actions utilisant la voix"},{"id":"touche-a-tout","name":"Touche-√†-tout","description":"+5 aux comp√©tences artistiques"},{"id":"instrument-favori","name":"Instrument favori","description":"+Niveau/2 avec un instrument choisi"},{"id":"sharing-soul","name":"Sharing Soul","description":"Partage une √©motion, exacerbe un sentiment"},{"id":"puttin-devil-jail","name":"Puttin' Devil in Jail","description":"Jet d'art avec le groupe, repousse n'importe quel adversaire"},{"id":"verbe-flatteur","name":"Verbe flatteur","description":"+Niveau/2 en S√©duction et Baratin"},{"id":"conteur-invetere","name":"Conteur inv√©t√©r√©","description":"Connaissance des mythes et l√©gendes"},{"id":"prestation-luxe","name":"Prestation de luxe","description":"Revenus des prestations √ó2"},{"id":"coeur-ouvrage","name":"C≈ìur √† l'ouvrage !","description":"3√ó/sc√©nario, +Niveau/2 √† un jet alli√©"}]},
          {"id":"ingenieur","name":"Ing√©nieur","description":"Inventeur et bricoleur de g√©nie, l'ing√©nieur cr√©e des merveilles m√©caniques et alchimiques.","avantages":[{"id":"bidouille","name":"La Bidouil' !","description":"+Niveau/2 aux jets de bricolage"},{"id":"ferrailleur","name":"Ferrailleur","description":"1 contact fournit 1 cargaison de mat√©riau par s√©ance"},{"id":"boutique","name":"Boutique","description":"Poss√®de une boutique"},{"id":"apprenti","name":"Apprenti","description":"Poss√®de un apprenti"},{"id":"chef-oeuvre","name":"Chef-d'≈ìuvre","description":"Cr√©e des objets de meilleure qualit√©"},{"id":"alchimie-materiaux","name":"Alchimie des mat√©riaux","description":"Peut m√©tamorphoser les mat√©riaux"},{"id":"amelioration-objet","name":"Am√©lioration d'objet","description":"Peut am√©liorer un objet"},{"id":"reparapide","name":"R√©parapide","description":"R√©pare plus vite"},{"id":"technomagie","name":"Technomagie","description":"Donne des effets magiques aux inventions"},{"id":"biomachine","name":"Biomachine","description":"Rend compatible chair et m√©canique"}]},
          {"id":"brigand","name":"Brigand","description":"Ma√Ætre de la discr√©tion urbaine et de la filouterie.","avantages":[{"id":"tout-le-monde","name":"M. Tout-Le-Monde","description":"+Niveau/2 Discr√©tion en ville"},{"id":"main-habile","name":"Main habile","description":"+Niveau/2 Chirurgie et Vol"},{"id":"spa-moa","name":"S'pa moa !","description":"+Niveau/2 Baratin"},{"id":"perception-ultime","name":"Perception ultime","description":"+Niveau/2 Perception en ville"},{"id":"analyse","name":"Analyse","description":"√âvalue quantit√© et qualit√© d'un butin"},{"id":"connais-gars","name":"J'connais un gars","description":"1 contact dans les bas-fonds"},{"id":"par-la","name":"Par l√† !","description":"+Niveau/2 Fouille"},{"id":"toc-toc","name":"Toc-Toc","description":"D√©g√¢ts √ó2 par surprise"},{"id":"tracage-piecette","name":"Tra√ßage de la pi√©cette","description":"Retrouve quelqu'un via argent donn√©"},{"id":"fondu-ombres","name":"Fondu dans les ombres","description":"Fondu ou invisibilit√© dans les ombres"}]},
          {"id":"paladin","name":"Paladin","description":"Champion d'une cause divine ou d'un id√©al sup√©rieur.","avantages":[{"id":"imposition-mains","name":"Imposition des mains","description":"X PF+PV = 2√óX PV soign√©s"},{"id":"rayon-brulure","name":"Rayon de br√ªlure","description":"X PV+PF = 2√óX d√©g√¢ts"},{"id":"stratege","name":"Strat√®ge","description":"+Niveau/2 Tactique"},{"id":"devotion","name":"D√©votion","description":"PF d√©pens√©s √ó2 pour comp√©tences de l'id√©al"},{"id":"sur-entraine","name":"Sur-entra√Æn√©","description":"+Niveau/2 Athl√©tisme"},{"id":"avatar","name":"Avatar","description":"Pouvoirs divins 5 rounds, contrecoup"},{"id":"favori","name":"Favori","description":"Artefact offert par l'entit√©"},{"id":"attaque-elementaire","name":"Attaque √©l√©mentaire","description":"+1D6 d√©g√¢ts √©l√©mentaires"},{"id":"purification","name":"Purification","description":"Purifie mal√©dictions et corruptions"},{"id":"analyse-aura","name":"Analyse d'aura","description":"Conna√Æt les alignements"}]},
          {"id":"chevalier","name":"Chevalier","description":"Guerrier noble li√© √† sa monture par un lien ind√©fectible.","avantages":[{"id":"appel-monture","name":"Appel de la monture","description":"Appelle sa monture √† distance"},{"id":"monture-chevalier","name":"Monture de chevalier","description":"Poss√®de une monture loyale"},{"id":"combat-monte","name":"Combat mont√©","description":"+Niveau/2 combat √† cheval"},{"id":"monture-guerre","name":"Monture de guerre","description":"Am√©liore le combat de la monture"},{"id":"ne-faire-quun","name":"Ne faire qu'un","description":"Transfert de PV avec la monture"},{"id":"lien-telempathique","name":"Lien t√©lempathique","description":"Communication mentale avec la monture"},{"id":"archerie-montee","name":"Archerie mont√©e","description":"+Niveau/2 tirs √† cheval"},{"id":"charge-cavalerie","name":"Charge de cavalerie","description":"Charge d√©vastatrice"},{"id":"esprit-indomptable","name":"Esprit indomptable","description":"+Niveau/2 Volont√©"},{"id":"acrobate-voltigeur","name":"Acrobate voltigeur","description":"+Niveau/2 acrobaties √† cheval"}]},
          {"id":"medecin","name":"M√©decin","description":"Gu√©risseur et scientifique du corps humain.","avantages":[{"id":"diagnostic-rapide","name":"Diagnostic rapide","description":"Identifie rapidement blessures et maladies"},{"id":"soin-rapide","name":"Soin rapide","description":"Soigne plus vite"},{"id":"cuisine","name":"Cuisine","description":"+Niveau/2 Cuisine (rem√®des)"},{"id":"resurrection","name":"R√©surrection","description":"Ram√®ne √† 1 PV, 1√ó/sc√©nario"},{"id":"cultiver-herbes","name":"Cultiver les herbes","description":"Fait pousser des herbes m√©dicinales"},{"id":"maitrise-poisons","name":"Ma√Ætrise des poisons","description":"Expert en poisons et antidotes"},{"id":"connaissances-anatomiques","name":"Connaissances anatomiques","description":"DEX √† r√©partir atk/d√©g√¢ts sur humano√Ødes"},{"id":"transplantation","name":"Transplantation miraculeuse","description":"Peut r√©aliser des implants"},{"id":"zone-bienfaisance","name":"Zone de bienfaisance","description":"Zone de soin DEX PV, 3 tours, 1√ó/sc√©nario"},{"id":"je-suis-medecin","name":"Je suis m√©decin !","description":"Passage prioritaire, +Niveau/2 Social"}]},
          {"id":"barbare","name":"Barbare","description":"Guerrier sauvage anim√© par une rage primitive.","avantages":[{"id":"ravage","name":"Ravage","description":"Attaque de zone tournoyante"},{"id":"fureur","name":"Fureur","description":"+Niveau/2 d√©g√¢ts"},{"id":"chaine-ancetres","name":"Cha√Æne des Anc√™tres","description":"Enchev√™trement magique"},{"id":"cri-guerre","name":"Cri de guerre","description":"+Niveau/2 atk PJ pendant FOR tours"},{"id":"il-en-faut-plus","name":"IL EN FAUT PLUS","description":"Revient full PV, prochaines actions ‚àí5"},{"id":"arme-lourde-main","name":"Arme lourde √† une main","description":"Manie armes lourdes √† une main"},{"id":"frappe-sismique","name":"Frappe sismique","description":"‚àíNiveau/2 zone pendant 2 tours"},{"id":"coup-brutal","name":"Coup brutal","description":"FOR vs FOR : d√©s√©quilibre/renverse/d√©sarme"},{"id":"haine-grandissante","name":"Haine grandissante","description":"+2/tour cumulatif entre d√©g√¢ts/atk/def/init"}]},
          {"id":"antimage","name":"Antimage","description":"Sp√©cialiste de la neutralisation magique.","avantages":[{"id":"insensibilite-magie","name":"Insensibilit√© √† la magie","description":"+Niveau/2 Volont√© contre magie"},{"id":"drain-magie","name":"Drain de magie","description":"Contact, Vol vs Vol pour prendre des PF"},{"id":"desenchantement","name":"D√©senchantement","description":"Rituel : retire la magie d'un objet"},{"id":"aimantation-repulsion","name":"Aimantation/R√©pulsion","description":"Attire ou repousse √©l√©ments magiques"},{"id":"stockage-magie","name":"Stockage de magie","description":"D√©passe le max de PF"},{"id":"decharge-magique","name":"D√©charge magique","description":"D√©charge offensive √©puisant les PF stock√©s"},{"id":"coupure-magie","name":"Coupure de la magie","description":"Rituel : coupe un individu de la magie"},{"id":"zone-antimagique","name":"Zone antimagique","description":"Rituel : r√©sistance magique sur zone"},{"id":"antimagemage","name":"Antimagemage","description":"Permet aux antimages d'apprendre une magie"},{"id":"analyse-magique","name":"Analyse magique","description":"Rep√®re les types de magie"}]},
          {"id":"diplomate","name":"Diplomate","description":"Ma√Ætre de la persuasion et des n√©gociations.","avantages":[{"id":"gueule-ange","name":"Gueule d'ange","description":"+Niveau/2 Social (beaut√©)"},{"id":"negoce","name":"N√©goce","description":"+Niveau/2 Marchandage"},{"id":"ange-passe","name":"Un ange passe","description":"Les foules se taisent pour laisser parler"},{"id":"voodoo-powa","name":"VooDoo Powa","description":"EMP vs Id√©al : fait tomber amoureux temporairement"},{"id":"commerage","name":"Comm√©rage","description":"Obtient des infos croustillantes"},{"id":"attaque-charismatique","name":"Attaque charismatique","description":"Ajoute EMP au score d'attaque"},{"id":"defense-charismatique","name":"D√©fense charismatique","description":"Ajoute EMP √† la d√©fense"},{"id":"psychologue","name":"Psychologue","description":"+Niveau/2 D√©tection de mensonge"},{"id":"polyglotte","name":"Polyglotte","description":"4 langues gratuites"},{"id":"chef-naturel","name":"Chef naturel","description":"Les PNJ suivent les directives"}]}
        ],
        "competences": [
          {"id":"acrobatie","name":"Acrobatie","attribut":"DEX"},
          {"id":"agriculture","name":"Agriculture","attribut":"INT"},
          {"id":"artisanat","name":"Artisanat","attribut":"DEX"},
          {"id":"athletisme","name":"Athl√©tisme","attribut":"FOR"},
          {"id":"bagarre","name":"Bagarre","attribut":"DEX"},
          {"id":"baratin","name":"Baratin","attribut":"EMP"},
          {"id":"bibliotheque","name":"Biblioth√®que","attribut":"INT"},
          {"id":"chasse","name":"Chasse","attribut":"EMP"},
          {"id":"chirurgie","name":"Chirurgie","attribut":"DEX"},
          {"id":"comedie","name":"Com√©die","attribut":"EMP"},
          {"id":"crochetage","name":"Crochetage","attribut":"DEX"},
          {"id":"deguisement","name":"D√©guisement","attribut":"DEX"},
          {"id":"diplomatie","name":"Diplomatie","attribut":"EMP"},
          {"id":"discretion","name":"Discr√©tion","attribut":"DEX"},
          {"id":"dressage","name":"Dressage","attribut":"EMP"},
          {"id":"droit","name":"Droit","attribut":"INT"},
          {"id":"eloquence","name":"√âloquence","attribut":"EMP"},
          {"id":"equitation","name":"√âquitation","attribut":"EMP"},
          {"id":"erudition","name":"√ârudition","attribut":"INT"},
          {"id":"esquive","name":"Esquive","attribut":"DEX"},
          {"id":"etiquette","name":"√âtiquette","attribut":"INT"},
          {"id":"fouille","name":"Fouille","attribut":"DEX"},
          {"id":"fronde","name":"Fronde","attribut":"DEX"},
          {"id":"herboristerie","name":"Herboristerie","attribut":"INT"},
          {"id":"informatique","name":"Informatique","attribut":"INT"},
          {"id":"ingenierie","name":"Ing√©nierie","attribut":"INT"},
          {"id":"intimidation","name":"Intimidation","attribut":"FOR"},
          {"id":"linguistique","name":"Linguistique","attribut":"INT"},
          {"id":"magie","name":"Magie","attribut":"‚Äî","description":"1 comp√©tence par type de magie"},
          {"id":"medecine","name":"M√©decine","attribut":"INT"},
          {"id":"melee","name":"M√™l√©e","attribut":"FOR"},
          {"id":"orientation","name":"Orientation","attribut":"SAG"},
          {"id":"parade","name":"Parade","attribut":"FOR"},
          {"id":"perception","name":"Perception","attribut":"EMP"},
          {"id":"perception-magique","name":"Perception magique","attribut":"EMP"},
          {"id":"piege","name":"Pi√®ge","attribut":"DEX"},
          {"id":"pilotage","name":"Pilotage","attribut":"DEX"},
          {"id":"poison","name":"Poison","attribut":"INT"},
          {"id":"psychologie","name":"Psychologie","attribut":"EMP"},
          {"id":"representation","name":"Repr√©sentation","attribut":"EMP"},
          {"id":"resistance","name":"R√©sistance","attribut":"FOR"},
          {"id":"seduction","name":"S√©duction","attribut":"EMP"},
          {"id":"survie","name":"Survie","attribut":"DEX"},
          {"id":"tactique","name":"Tactique","attribut":"SAG"},
          {"id":"theologie","name":"Th√©ologie","attribut":"SAG"},
          {"id":"tir","name":"Tir","attribut":"DEX"},
          {"id":"vol","name":"Vol","attribut":"DEX"},
          {"id":"volonte","name":"Volont√©","attribut":"SAG"},
          {"id":"zoologie","name":"Zoologie","attribut":"INT"}
        ],
        "avantagesGeneraux": [
          {"id":"connaissance-magie","name":"Connaissance d'une magie","description":"Le personnage a la capacit√© d'utiliser l'une des nombreuses formes de magie disponibles sur Ga√Øa."},
          {"id":"ambidextrie","name":"Ambidextrie","description":"Le personnage dispose de deux actions par tour de combat."},
          {"id":"action-combinee","name":"Action combin√©e","description":"Pr√©requis : pouvoir faire deux actions par tour. Permet au personnage de faire une seule action au lieu de deux, mais augment√©e de 50 % (100 % si en full attaque)."},
          {"id":"action-supplementaire-specifique","name":"Action suppl√©mentaire sp√©cifique","description":"Permet d'avoir une action gratuite dont la nature doit √™tre sp√©cifi√©e √† la prise de l'avantage. Peut se cumuler avec Ambidextrie. Sauf conditions particuli√®res, cette action gratuite ne peut pas √™tre une action d'attaque."},
          {"id":"infatigable","name":"Infatigable","description":"R√©duit la quantit√© de repos dont le personnage a besoin."},
          {"id":"hyperactif","name":"Hyperactif","description":"Pr√©requis : Infatigable. Le personnage dispose de trois actions au lieu de deux entre deux s√©ances."},
          {"id":"eleve-doue","name":"√âl√®ve dou√©","description":"R√©duit l'entra√Ænement d'une comp√©tence √† 3 actions au lieu de 4."},
          {"id":"superiorite-martiale","name":"Sup√©riorit√© martiale","description":"Permet de rajouter la moiti√© de la diff√©rence entre son attaque et la d√©fense de l'adversaire aux d√©g√¢ts."},
          {"id":"suprematie-martiale","name":"Supr√©matie martiale","description":"Pr√©requis : Sup√©riorit√© martiale. Permet de rajouter la diff√©rence totale entre l'attaque et la d√©fense au lieu de la moiti√©."},
          {"id":"avantage-autre-classe","name":"Avantage d'une autre classe","description":"Co√ªte l'√©quivalent de deux avantages (6 points de cr√©ation). Permet de choisir un avantage appartenant √† une classe diff√©rente de la sienne."},
          {"id":"style-particulier","name":"Style particulier","description":"Remplace une caract√©ristique par une autre dans une comp√©tence sp√©cifique ou les jets de d√©g√¢ts."},
          {"id":"expertise-competence","name":"Expertise de comp√©tence","description":"Ajoute les rangs d'une comp√©tence d√©finie aux jets d'une autre comp√©tence d√©finie."},
          {"id":"accompagner-coups","name":"Accompagner les coups","description":"Ajoute la Dext√©rit√© √† la RD, uniquement si une tentative d'esquive ou de parade a pu √™tre faite."},
          {"id":"developper-technique-sort","name":"D√©velopper une technique ou un sort","description":"G√©n√©ralement moins co√ªteux ou plus puissant qu'une action improvis√©e. Permet de cr√©er une technique ou un sort personnalis√©."},
          {"id":"regroupement-competences","name":"Regroupement de comp√©tences","description":"Un avantage (3 points) par comp√©tence regroup√©e, si celles-ci utilisent la m√™me caract√©ristique. Permet de lier plusieurs comp√©tences entre elles."}
        ],
        "levelUps": [
          {"level":2,"options":[{"id":"pv","name":"+2 PV max","effect":{"type":"pv","value":2}},{"id":"pf","name":"+2 PF max","effect":{"type":"pf","value":2}},{"id":"comp","name":"+2 points de comp√©tence","effect":{"type":"competence","value":2}},{"id":"carac","name":"+1 caract√©ristique","effect":{"type":"caracteristique","value":1}}]},
          {"level":3,"options":[{"id":"pv","name":"+2 PV max","effect":{"type":"pv","value":2}},{"id":"pf","name":"+2 PF max","effect":{"type":"pf","value":2}},{"id":"comp","name":"+2 points de comp√©tence","effect":{"type":"competence","value":2}},{"id":"carac","name":"+1 caract√©ristique","effect":{"type":"caracteristique","value":1}},{"id":"avantage","name":"Nouvel avantage de classe","effect":{"type":"avantage","value":1}}]},
          {"level":4,"options":[{"id":"pv","name":"+3 PV max","effect":{"type":"pv","value":3}},{"id":"pf","name":"+3 PF max","effect":{"type":"pf","value":3}},{"id":"comp","name":"+3 points de comp√©tence","effect":{"type":"competence","value":3}},{"id":"carac","name":"+1 caract√©ristique","effect":{"type":"caracteristique","value":1}}]},
          {"level":5,"options":[{"id":"pv","name":"+3 PV max","effect":{"type":"pv","value":3}},{"id":"pf","name":"+3 PF max","effect":{"type":"pf","value":3}},{"id":"comp","name":"+3 points de comp√©tence","effect":{"type":"competence","value":3}},{"id":"carac","name":"+2 caract√©ristiques","effect":{"type":"caracteristique","value":2}},{"id":"avantage","name":"Nouvel avantage de classe","effect":{"type":"avantage","value":1}}]}
        ]
      };
      
      let currentStep = 1;
      const totalSteps = 8;
      
      // √âtat de cr√©ation
      const creationState = {
        race: null,
        // Nouveau syst√®me de d√©s : chaque carac a un d√© attribu√© (D4=4, D6=6, D8=8, D10=10, D12=12)
        attributes: { force: null, dex: null, emp: null, sag: null, int: null },
        // Bonus de caract√©ristiques (provenant de la race, etc.)
        attributeBonuses: { force: 0, dex: 0, emp: 0, sag: 0, int: 0 },
        // D√©s disponibles (non encore attribu√©s)
        availableDice: [4, 6, 8, 10, 12],
        classe: null,
        primaryAdvantage: null,
        competences: {},
        compPointsUsed: 0,
        secondaryAdvantages: [],
        customAdvantages: [], // Avantages personnalis√©s cr√©√©s par le joueur
        name: '',
        alignment: '',
        // Level Up system
        levelUpCount: 0,
        levelUpPointsTotal: 0,
        levelUpPointsSpent: 0,
        levelUpChoices: [], // Array of { type, cost, details }
        levelUpCurrentSelection: null // Type d'am√©lioration en cours de s√©lection
      };
      
      // Mapping des bonus de caract√©ristiques par race
      const raceBonuses = {
        'orc': { force: 1 },
        'troll': { force: 1 },
        'gobelin': { dex: 1 },
        'sylphe': { force: -1 },
        'daedroth': { int: -1 }
        // Note: hybride a un choix (+1 DEX ou FOR) - √† g√©rer s√©par√©ment si besoin
      };
      
      // Applique les bonus de race aux caract√©ristiques
      function applyRaceBonuses() {
        // Reset des bonus
        creationState.attributeBonuses = { force: 0, dex: 0, emp: 0, sag: 0, int: 0 };
        
        if (creationState.race && raceBonuses[creationState.race.id]) {
          const bonuses = raceBonuses[creationState.race.id];
          for (const [attr, value] of Object.entries(bonuses)) {
            creationState.attributeBonuses[attr] = value;
          }
        }
      }
      
      // Calcule la valeur finale d'une caract√©ristique (d√© + bonus)
      function getFinalAttribute(attr) {
        const baseValue = parseInt(creationState.attributes[attr]) || 0;
        const raceBonus = creationState.attributeBonuses[attr] || 0;
        
        // Compter les augmentations de Level Up pour cette caract√©ristique
        const levelUpBonus = creationState.levelUpChoices
          .filter(c => c.type === 'caracteristique' && c.details && c.details.attr === attr)
          .length;
        
        // Bonus total = race + level ups (chaque level up = +1 niveau de d√©)
        const totalBonus = raceBonus + levelUpBonus;
        
        if (baseValue === 0) return { value: 0, die: null, bonus: 0, display: '-' };
        
        // Chaque +1 augmente le d√© d'un cran (D4->D6->D8->D10->D12)
        // Au-del√† de D12, on reste √† D12 avec un bonus
        const diceProgression = [4, 6, 8, 10, 12];
        let currentIndex = diceProgression.indexOf(baseValue);
        
        // Si la valeur n'est pas trouv√©e, trouver l'index le plus proche
        if (currentIndex === -1) {
          currentIndex = diceProgression.findIndex(d => d >= baseValue);
          if (currentIndex === -1) currentIndex = diceProgression.length - 1;
        }
        
        let extraBonus = 0;
        
        if (totalBonus > 0) {
          // Bonus positif : monter les d√©s
          for (let i = 0; i < totalBonus; i++) {
            if (currentIndex < diceProgression.length - 1) {
              currentIndex++;
            } else {
              // D√©j√† au D12, ajouter un bonus
              extraBonus++;
            }
          }
        } else if (totalBonus < 0) {
          // Malus : descendre les d√©s
          for (let i = 0; i < Math.abs(totalBonus); i++) {
            if (currentIndex > 0) {
              currentIndex--;
            }
            // En dessous de D4, reste √† D4
          }
        }
        
        const finalDie = diceProgression[currentIndex];
        const display = extraBonus > 0 ? `D${finalDie} +${extraBonus}` : `D${finalDie}`;
        
        return { value: finalDie, die: finalDie, bonus: extraBonus, display, baseValue, raceBonus: raceBonus, levelUpBonus: levelUpBonus };
      }
      
      const attrNames = {
        force: 'Force',
        dex: 'Dext√©rit√©',
        emp: 'Empathie',
        sag: 'Sagesse',
        int: 'Intelligence'
      };
      
      // Initialiser le wizard
      function initWizard() {
        
        // Bouton d√©marrer
        document.getElementById('btn-start-wizard').addEventListener('click', () => {
          document.getElementById('wizard-intro').style.display = 'none';
          document.getElementById('wizard-steps').classList.add('active');
          renderStep(1);
        });
        
        // Bouton passer
        document.getElementById('btn-skip-wizard').addEventListener('click', () => {
          document.getElementById('wizard-container').style.display = 'none';
        });
        
        // Navigation
        for (let i = 1; i <= totalSteps; i++) {
          const prevBtn = document.getElementById(`btn-prev-${i}`);
          const nextBtn = document.getElementById(`btn-next-${i}`);
          if (prevBtn) prevBtn.addEventListener('click', () => goToStep(i - 1));
          if (nextBtn) nextBtn.addEventListener('click', () => goToStep(i + 1));
        }
        
        // Bouton confirmer
        document.getElementById('btn-confirm').addEventListener('click', generateCharacterSheet);
        
        // Progress bar click
        document.querySelectorAll('.progress-step').forEach(step => {
          step.addEventListener('click', () => {
            const stepNum = parseInt(step.dataset.step);
            if (canNavigateToStep(stepNum)) {
              goToStep(stepNum);
            }
          });
        });
      }
      
      function canNavigateToStep(step) {
        // Peut naviguer vers les √©tapes pr√©c√©dentes ou compl√©t√©es
        // Si on est √† l'√©tape 9 (termin√©e), on peut aller √† n'importe quelle √©tape 1-8
        if (currentStep === 9 && step >= 1 && step <= 8) return true;
        return step <= currentStep;
      }
      
      function goToStep(step) {
        // Permettre la navigation vers les √©tapes 1-8 (m√™me depuis l'√©tape 9)
        if (step < 1 || step > 8) return;
        
        const previousStep = currentStep;
        
        // Si on revient de l'√©tape 9 (termin√©e), cacher le message et r√©initialiser le s√©parateur
        if (previousStep === 9) {
          const separator = document.getElementById('wizard-separator');
          separator.innerHTML = '<h3 style="text-align: center; color: #666;">‚Üì Votre fiche de personnage ‚Üì</h3>';
          // Cacher l'√©tape 9 dans la barre de progression
          const step9 = document.querySelector('.progress-step[data-step="9"]');
          if (step9) step9.style.display = 'none';
        }
        
        // Appliquer les changements de l'√©tape pr√©c√©dente √† la fiche (quand on avance)
        if (step > previousStep && previousStep !== 9) {
          applyStepToSheet(previousStep);
        }
        
        // Cacher l'√©tape actuelle (seulement si ce n'est pas l'√©tape 9 qui n'a pas de contenu)
        if (previousStep !== 9) {
          const prevStepContent = document.querySelector(`.step-content[data-step="${previousStep}"]`);
          if (prevStepContent) prevStepContent.classList.remove('active');
        }
        
        // Afficher la nouvelle √©tape
        currentStep = step;
        const newStepContent = document.querySelector(`.step-content[data-step="${currentStep}"]`);
        if (newStepContent) newStepContent.classList.add('active');
        
        // Mettre √† jour la progress bar
        updateProgressBar();
        
        // Rendre le contenu de l'√©tape
        renderStep(step);
        
        // Afficher le s√©parateur et scroller vers la fiche quand on avance
        if (step > 1) {
          document.getElementById('wizard-separator').style.display = 'block';
        }
        
        // Scroll vers le haut du wizard pour voir la nouvelle √©tape (apr√®s un court d√©lai pour le DOM)
        setTimeout(() => {
          const wizardContainer = document.getElementById('wizard-container');
          if (wizardContainer) {
            wizardContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 100);
      }
      
      // Appliquer les changements d'une √©tape √† la fiche
      function applyStepToSheet(step) {
        switch (step) {
          case 1: 
            updateSheetRace(); 
            break;
          case 2: 
            updateSheetAttributes(); 
            break;
          case 3: 
            updateSheetClass(); 
            break;
          case 4: 
            updateSheetCapacities(); 
            break;
          case 5: 
            updateSheetCompetences(); 
            break;
          case 6: 
            updateSheetCapacities(); 
            break;
          case 7: 
            updateSheetNameAndStats(); 
            break;
        }
      }
      
      function updateProgressBar() {
        document.querySelectorAll('.progress-step').forEach(step => {
          const stepNum = parseInt(step.dataset.step);
          step.classList.remove('active', 'completed');
          if (stepNum === currentStep) {
            step.classList.add('active');
          } else if (stepNum < currentStep) {
            step.classList.add('completed');
          }
        });
      }
      
      function renderStep(step) {
        switch (step) {
          case 1: renderRaceOptions(); break;
          case 2: applyRaceBonuses(); renderAttributeDistribution(); break;
          case 3: renderClassOptions(); break;
          case 4: renderPrimaryAdvantageOptions(); break;
          case 5: renderCompetenceDistribution(); break;
          case 6: renderSecondaryAdvantageOptions(); break;
          case 7: renderNameAndStats(); break;
          case 8: renderLevelUpOptions(); break;
        }
      }
      
      // ========== FONCTIONS DE MISE √Ä JOUR DE LA FICHE ==========
      
      // Mettre √† jour la case Race et les bonus de race
      function updateSheetRace() {
        if (!creationState.race) return;
        
        // Case Race
        const raceField = document.getElementById('race');
        if (raceField) raceField.value = creationState.race.name;
        
        // Fonction pour formater un bonus/malus avec le nom en gras
        function formatTrait(trait) {
          const colonIndex = trait.indexOf(':');
          if (colonIndex > 0) {
            const name = trait.substring(0, colonIndex).trim();
            const desc = trait.substring(colonIndex + 1).trim();
            return `<li><strong>${name}</strong> : ${desc}</li>`;
          }
          return `<li>${trait}</li>`;
        }
        
        // Bonus de race
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
          const h3 = section.querySelector('h3');
          if (h3 && h3.textContent.includes('Bonus de race')) {
            const list = section.querySelector('.abilities-list');
            if (list) {
              const allTraits = [];
              if (creationState.race.bonuses) {
                creationState.race.bonuses.forEach(b => allTraits.push(formatTrait(b)));
              }
              if (creationState.race.maluses && creationState.race.maluses.length > 0) {
                creationState.race.maluses.forEach(m => allTraits.push(formatTrait(m)));
              }
              list.innerHTML = allTraits.join('');
            }
          }
        });
      }
      
      // Mettre √† jour les caract√©ristiques
      function updateSheetAttributes() {
        const attrMap = { force: 'force', dex: 'dex', emp: 'emp', sag: 'sag', int: 'int' };
        for (const [key, id] of Object.entries(attrMap)) {
          const input = document.getElementById(id);
          if (input) {
            const finalAttr = getFinalAttribute(key);
            
            // Mettre la valeur du d√© final dans l'input number
            if (finalAttr.value > 0) {
              input.value = finalAttr.value;
            } else {
              input.value = '';
            }
            input.dispatchEvent(new Event('input')); // D√©clenche la mise √† jour du d√© affich√©
            
            // Mettre le bonus dans le petit champ +0 (le 3√®me √©l√©ment dans value-wrap)
            const attrBox = input.closest('.attr-box');
            if (attrBox) {
              const bonusInput = attrBox.querySelector('input[type="text"]');
              if (bonusInput && finalAttr.bonus > 0) {
                bonusInput.value = `+${finalAttr.bonus}`;
              } else if (bonusInput) {
                bonusInput.value = '+0';
              }
            }
          }
        }
      }
      
      // Mettre √† jour la case Classe
      function updateSheetClass() {
        if (!creationState.classe) return;
        const classField = document.getElementById('class');
        if (classField) classField.value = creationState.classe.name;
      }
      
      // Mettre √† jour les avantages/capacit√©s
      function updateSheetCapacities() {
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
          const h3 = section.querySelector('h3');
          if (h3 && (h3.textContent.includes('Capacit√©s') || h3.textContent.includes('Avantages'))) {
            const list = section.querySelector('.abilities-list');
            if (list) {
              const capacities = [];
              
              // Avantage primaire (de classe)
              if (creationState.primaryAdvantage) {
                capacities.push(`<li><strong>${creationState.primaryAdvantage.name}</strong> : ${creationState.primaryAdvantage.description}</li>`);
              }
              
              // Avantages secondaires (classe + g√©n√©raux)
              creationState.secondaryAdvantages.forEach(adv => {
                const prefix = adv.isGeneral ? '‚óÜ ' : '';
                capacities.push(`<li><strong>${prefix}${adv.name}</strong> : ${adv.description}</li>`);
              });
              
              // Avantages personnalis√©s
              creationState.customAdvantages.forEach(adv => {
                if (adv.name && adv.name.trim() !== '') {
                  capacities.push(`<li><strong>‚ú¶ ${adv.name}</strong> : ${adv.description || 'Pas de description'}</li>`);
                }
              });
              
              if (capacities.length > 0) {
                list.innerHTML = capacities.join('');
              }
            }
          }
        });
      }
      
      // Mettre √† jour les comp√©tences
      function updateSheetCompetences() {
        const skillsBody = document.querySelector('.skill-table tbody');
        if (!skillsBody) {
          console.error('Tableau des comp√©tences non trouv√©');
          return;
        }
        
        // Collecter toutes les comp√©tences (√©tape 5 + level ups)
        const allComps = {};
        
        // Comp√©tences de l'√©tape 5
        for (const [compId, value] of Object.entries(creationState.competences)) {
          if (value && value > 0) {
            allComps[compId] = (allComps[compId] || 0) + value;
          }
        }
        
        // Ajouter les comp√©tences des Level Ups
        creationState.levelUpChoices
          .filter(c => c.type === 'competence' && c.details && c.details.compId)
          .forEach(choice => {
            allComps[choice.details.compId] = (allComps[choice.details.compId] || 0) + 1;
          });
        
        // Construire la liste des comp√©tences avec leurs infos
        const usedComps = [];
        for (const [compId, value] of Object.entries(allComps)) {
          const comp = characterData.competences.find(c => c.id === compId);
          if (comp) {
            usedComps.push({ comp, value });
          }
        }
        
        // Trier par nom
        usedComps.sort((a, b) => a.comp.name.localeCompare(b.comp.name));
        
        // Toujours vider et reconstruire le tableau
        skillsBody.innerHTML = '';
        
        if (usedComps.length > 0) {
          usedComps.forEach(({ comp, value }) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><input value="${comp.name}" /></td>
              <td><input value="${comp.attribut}" /></td>
              <td><input type="text" value="+${value}" style="text-align:center;" /></td>
            `;
            skillsBody.appendChild(row);
          });
        } else {
          // Ajouter des lignes vides par d√©faut si aucune comp√©tence
          for (let i = 0; i < 6; i++) {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><input /></td>
              <td><input placeholder="FOR" /></td>
              <td><input type="number" placeholder="+0" /></td>
            `;
            skillsBody.appendChild(row);
          }
        }
      }
      
      // Calculer les PV (FOR√ó2 + INT√ó2 + 10 + Niveau + Bonus)
      function calculatePV() {
        const niveau = 1 + (creationState.levelUpCount || 0); // Niveau de base + level ups
        let bonusPV = 0;
        
        // Utiliser getFinalAttribute pour obtenir les valeurs finales incluant tous les bonus
        const forceAttr = getFinalAttribute('force');
        const intelAttr = getFinalAttribute('int');
        
        // Valeur de la caract√©ristique = valeur du d√© + bonus au-del√† de D12
        // Pour le calcul des PV, on utilise la valeur du d√© + le bonus extra
        const forceValue = (forceAttr.value || 0) + (forceAttr.bonus || 0);
        const intelValue = (intelAttr.value || 0) + (intelAttr.bonus || 0);
        
        // TODO: Ajouter les bonus de race ou d'avantage qui augmentent les PV
        
        const pv = (forceValue * 2) + (intelValue * 2) + 10 + niveau + bonusPV;
        return { pv, force: forceValue, intel: intelValue, niveau, bonusPV, forceBonus: forceAttr.bonus, intelBonus: intelAttr.bonus };
      }
      
      // Calculer les PF (PF = PV + Bonus)
      function calculatePF(pv) {
        let bonusPF = 0;
        
        // TODO: Ajouter les bonus de race ou d'avantage qui augmentent les PF
        
        return { pf: pv + bonusPF, bonusPF };
      }
      
      // Mettre √† jour le nom et les stats vitales
      function updateSheetNameAndStats() {
        const nameInput = document.getElementById('wizard-name');
        const alignmentSelect = document.getElementById('wizard-alignment');
        const nameField = document.getElementById('name');
        const alignmentField = document.getElementById('alignement');
        const levelField = document.getElementById('level');
        const pvMaxField = document.getElementById('pv-max');
        const pvCurrentField = document.getElementById('pv-current');
        const pfMaxField = document.getElementById('pf-max');
        const pfCurrentField = document.getElementById('pf-current');
        
        if (nameInput && nameField) {
          nameField.value = nameInput.value;
        }
        
        if (alignmentSelect && alignmentField) {
          alignmentField.value = alignmentSelect.value;
        } else if (creationState.alignment && alignmentField) {
          alignmentField.value = creationState.alignment;
        }
        
        if (levelField) {
          levelField.value = 1;
        }
        
        const { pv } = calculatePV();
        const { pf } = calculatePF(pv);
        
        if (pvMaxField) pvMaxField.value = pv;
        if (pvCurrentField) pvCurrentField.value = pv;
        if (pfMaxField) pfMaxField.value = pf;
        if (pfCurrentField) pfCurrentField.value = pf;
      }
      
      // √âtape 1: Races
      // Chemins des images
      function getRaceImagePath(raceId) {
        return `img/races/${raceId}.webp`;
      }
      
      function getClassImagePath(classId) {
        return `img/classes/${classId}.webp`;
      }
      
      function renderRaceOptions() {
        const container = document.getElementById('race-options');
        container.innerHTML = '';
        
        // Fonction pour formater un bonus/malus avec le nom en gras
        function formatTrait(trait) {
          const colonIndex = trait.indexOf(':');
          if (colonIndex > 0) {
            const name = trait.substring(0, colonIndex).trim();
            const desc = trait.substring(colonIndex + 1).trim();
            return `<li><strong>${name}</strong> : ${desc}</li>`;
          }
          return `<li>${trait}</li>`;
        }
        
        characterData.races.forEach(race => {
          const card = document.createElement('div');
          card.className = 'option-card' + (creationState.race?.id === race.id ? ' selected' : '');
          
          // G√©n√©rer la liste des bonus
          const bonusesHtml = race.bonuses && race.bonuses.length > 0 
            ? `<ul class="option-bonuses">${race.bonuses.map(b => formatTrait(b)).join('')}</ul>` 
            : '';
          
          // G√©n√©rer la liste des malus
          const malusesHtml = race.maluses && race.maluses.length > 0 
            ? `<ul class="option-maluses">${race.maluses.map(m => formatTrait(m)).join('')}</ul>` 
            : '';
          
          card.innerHTML = `
            <img src="${getRaceImagePath(race.id)}" alt="${race.name}" class="option-img" onerror="this.style.display='none'">
            <div class="option-content">
              <div class="option-name">${race.name}</div>
              <div class="option-desc">${race.description}</div>
              ${bonusesHtml}
              ${malusesHtml}
            </div>
          `;
          card.addEventListener('click', () => {
            creationState.race = race;
            applyRaceBonuses();
            renderRaceOptions();
            document.getElementById('btn-next-1').disabled = false;
          });
          container.appendChild(card);
        });
      }
      
      // √âtape 2: Caract√©ristiques
      // Syst√®me de d√©s pour les caract√©ristiques
      let selectedDice = null; // D√© actuellement s√©lectionn√©
      
      function renderAttributeDistribution() {
        const dicePool = document.getElementById('dice-pool');
        const container = document.getElementById('attr-distribute');
        
        const attrs = ['force', 'dex', 'emp', 'sag', 'int'];
        const allDice = [4, 6, 8, 10, 12];
        
        // Calculer les d√©s utilis√©s
        const usedDice = Object.values(creationState.attributes).filter(d => d !== null);
        const availableDice = allDice.filter(d => !usedDice.includes(d));
        
        // Afficher le pool de d√©s
        dicePool.innerHTML = '<div class="dice-instructions">üé≤ Cliquez sur un d√©, puis sur une caract√©ristique pour l\'assigner</div>';
        
        const diceContainer = document.createElement('div');
        diceContainer.style.cssText = 'display:flex; justify-content:center; gap:0.75rem; flex-wrap:wrap; margin-top:0.5rem;';
        
        allDice.forEach(dice => {
          const isUsed = usedDice.includes(dice);
          const isSelected = selectedDice === dice;
          
          const diceEl = document.createElement('div');
          diceEl.className = 'dice-item' + (isUsed ? ' used' : '') + (isSelected ? ' selected' : '');
          diceEl.innerHTML = `D${dice}`;
          diceEl.title = isUsed ? 'Ce d√© est d√©j√† assign√©' : `Cliquez pour s√©lectionner le D${dice}`;
          
          if (!isUsed) {
            diceEl.addEventListener('click', () => {
              selectedDice = isSelected ? null : dice;
              renderAttributeDistribution();
            });
          }
          
          diceContainer.appendChild(diceEl);
        });
        
        dicePool.appendChild(diceContainer);
        
        // Afficher les caract√©ristiques
        container.innerHTML = '';
        
        attrs.forEach(attr => {
          const value = creationState.attributes[attr];
          const hasDice = value !== null;
          const raceBonus = creationState.attributeBonuses[attr] || 0;
          const finalAttr = getFinalAttribute(attr);
          
          const item = document.createElement('div');
          item.className = 'attr-item' + (hasDice ? ' has-dice' : '') + (selectedDice && !hasDice ? ' selected-target' : '');
          
          // Affichage du bonus de race
          let bonusHtml = '';
          if (raceBonus !== 0) {
            const bonusColor = raceBonus > 0 ? '#27ae60' : '#c0392b';
            const bonusSign = raceBonus > 0 ? '+' : '';
            bonusHtml = `<div style="font-size:11px; color:${bonusColor}; margin-top:0.25rem;">(Race : ${bonusSign}${raceBonus})</div>`;
          }
          
          if (hasDice) {
            // Afficher le d√© final avec le bonus de race appliqu√©
            const finalDisplay = raceBonus !== 0 
              ? `<span style="text-decoration:line-through; opacity:0.5;">D${value}</span> ‚Üí <strong>${finalAttr.display}</strong>`
              : `D${value}`;
            
            item.innerHTML = `
              <label>${attrNames[attr]}</label>
              <div class="attr-dice-display">${finalDisplay}</div>
              <div class="attr-value-display">Valeur : ${finalAttr.value}${finalAttr.bonus > 0 ? ' +' + finalAttr.bonus : ''}</div>
              ${bonusHtml}
              <button style="margin-top:0.5rem; padding:0.25rem 0.5rem; font-size:12px; background:#c0392b; color:#fff; border:none; border-radius:0.25rem; cursor:pointer;" data-attr="${attr}">‚úó Retirer</button>
            `;
          } else {
            item.innerHTML = `
              <label>${attrNames[attr]}</label>
              <div class="attr-empty">${selectedDice ? '‚Üê Cliquez ici' : 'Aucun d√©'}</div>
              ${bonusHtml}
            `;
          }
          
          // Event listener pour assigner ou retirer un d√©
          item.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
              // Retirer le d√©
              creationState.attributes[attr] = null;
              selectedDice = null;
              renderAttributeDistribution();
            } else if (selectedDice && !hasDice) {
              // Assigner le d√© s√©lectionn√©
              creationState.attributes[attr] = selectedDice;
              selectedDice = null;
              renderAttributeDistribution();
            }
          });
          
          container.appendChild(item);
        });
        
        // V√©rifier si toutes les caract√©ristiques sont assign√©es
        const allAssigned = attrs.every(attr => creationState.attributes[attr] !== null);
        document.getElementById('btn-next-2').disabled = !allAssigned;
      }
      
      // √âtape 3: Classes
      function renderClassOptions() {
        const container = document.getElementById('class-options');
        container.innerHTML = '';
        
        characterData.classes.forEach(cls => {
          const card = document.createElement('div');
          card.className = 'option-card' + (creationState.classe?.id === cls.id ? ' selected' : '');
          
          // G√©n√©rer la liste des avantages de la classe (m√™me format que les races)
          const avantagesHtml = (cls.avantages || []).map(adv => 
            `<li><strong>${adv.name}</strong> : ${adv.description}</li>`
          ).join('');
          
          card.innerHTML = `
            <img src="${getClassImagePath(cls.id)}" alt="${cls.name}" class="option-img" onerror="this.style.display='none'">
            <div class="option-content">
              <div class="option-name">${cls.name}</div>
              <div class="option-desc">${cls.description}</div>
              ${avantagesHtml ? `<ul class="option-bonuses">${avantagesHtml}</ul>` : ''}
            </div>
          `;
          card.addEventListener('click', () => {
            creationState.classe = cls;
            creationState.primaryAdvantage = null;
            creationState.secondaryAdvantages = [];
            renderClassOptions();
            document.getElementById('btn-next-3').disabled = false;
          });
          container.appendChild(card);
        });
      }
      
      // √âtape 4: Avantage de classe
      function renderPrimaryAdvantageOptions() {
        const container = document.getElementById('primary-advantage-options');
        container.innerHTML = '';
        
        if (!creationState.classe) {
          container.innerHTML = '<p style="text-align:center;color:#e74c3c;">Veuillez d\'abord choisir une classe.</p>';
          return;
        }
        
        // Utiliser tous les avantages de la classe
        const avantages = creationState.classe.avantages || [];
        
        avantages.forEach(adv => {
          const card = document.createElement('div');
          card.className = 'option-card-simple' + (creationState.primaryAdvantage?.id === adv.id ? ' selected' : '');
          card.innerHTML = `
            <div class="option-name">${adv.name}</div>
            <div class="option-desc">${adv.description}</div>
          `;
          card.addEventListener('click', () => {
            creationState.primaryAdvantage = adv;
            renderPrimaryAdvantageOptions();
            document.getElementById('btn-next-4').disabled = false;
          });
          container.appendChild(card);
        });
      }
      
      // √âtape 5: Comp√©tences
      function renderCompetenceDistribution() {
        const container = document.getElementById('comp-distribute');
        container.innerHTML = '';
        
        const maxPoints = 12;
        const maxPerComp = 3; // Maximum +3 par comp√©tence
        const pointsRemaining = maxPoints - creationState.compPointsUsed;
        
        characterData.competences.forEach(comp => {
          const value = creationState.competences[comp.id] || 0;
          const isMaxed = value >= maxPerComp;
          
          const item = document.createElement('div');
          item.className = 'comp-item' + (value > 0 ? ' has-points' : '');
          item.innerHTML = `
            <div class="comp-info">
              <span class="comp-name">${comp.name}</span>
              <span class="comp-attr">${comp.attribut}</span>
            </div>
            <div class="comp-controls">
              <button data-comp="${comp.id}" data-action="dec" ${value <= 0 ? 'disabled' : ''}>‚àí</button>
              <span class="comp-value" style="${value > 0 ? 'color:#27ae60;font-weight:bold;' : ''}">+${value}</span>
              <button data-comp="${comp.id}" data-action="inc" ${isMaxed || pointsRemaining <= 0 ? 'disabled' : ''}>+</button>
            </div>
          `;
          container.appendChild(item);
        });
        
        // Event listeners
        container.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', () => {
            const comp = btn.dataset.comp;
            const action = btn.dataset.action;
            const currentValue = creationState.competences[comp] || 0;
            
            if (action === 'inc' && currentValue < maxPerComp && creationState.compPointsUsed < maxPoints) {
              creationState.competences[comp] = currentValue + 1;
              creationState.compPointsUsed++;
            } else if (action === 'dec' && currentValue > 0) {
              creationState.competences[comp] = currentValue - 1;
              creationState.compPointsUsed--;
            }
            renderCompetenceDistribution();
          });
        });
        
        // Update points display
        const remaining = document.getElementById('comp-points-remaining');
        remaining.textContent = pointsRemaining;
        remaining.className = 'remaining' + (pointsRemaining === 0 ? ' done' : pointsRemaining < 4 ? ' warning' : '');
        
        // Enable/disable next button
        document.getElementById('btn-next-5').disabled = pointsRemaining !== 0;
      }
      
      // √âtape 6: Avantages secondaires
      function renderSecondaryAdvantageOptions() {
        const container = document.getElementById('secondary-advantage-options');
        container.innerHTML = '';
        
        if (!creationState.classe) {
          container.innerHTML = '<p style="text-align:center;color:#e74c3c;">Veuillez d\'abord choisir une classe.</p>';
          return;
        }
        
        // Compte total des avantages s√©lectionn√©s (class + g√©n√©ral + custom)
        const totalSelected = creationState.secondaryAdvantages.length + creationState.customAdvantages.length;
        
        // === SECTION 1: Avantages de classe ===
        const classTitle = document.createElement('h4');
        classTitle.className = 'advantages-section-title';
        classTitle.textContent = `Avantages de classe : ${creationState.classe.name}`;
        container.appendChild(classTitle);
        
        const classGrid = document.createElement('div');
        classGrid.className = 'options-grid-4col';
        container.appendChild(classGrid);
        
        // Utiliser tous les avantages de classe sauf celui choisi comme primaire
        const avantagesClasse = (creationState.classe.avantages || []).filter(
          adv => !creationState.primaryAdvantage || adv.id !== creationState.primaryAdvantage.id
        );
        
        avantagesClasse.forEach(adv => {
          const isSelected = creationState.secondaryAdvantages.some(a => a.id === adv.id && !a.isGeneral);
          const card = document.createElement('div');
          card.className = 'option-checkbox-simple' + (isSelected ? ' selected' : '');
          card.innerHTML = `
            <span class="checkbox-mark"></span>
            <div>
              <div class="option-name">${adv.name}</div>
              <div class="option-desc">${adv.description}</div>
            </div>
          `;
          card.addEventListener('click', () => {
            if (isSelected) {
              creationState.secondaryAdvantages = creationState.secondaryAdvantages.filter(a => a.id !== adv.id);
            } else if (totalSelected < 3) {
              creationState.secondaryAdvantages.push({ ...adv, isGeneral: false });
            }
            renderSecondaryAdvantageOptions();
          });
          classGrid.appendChild(card);
        });
        
        // === SECTION 2: Avantages g√©n√©raux ===
        const generalTitle = document.createElement('h4');
        generalTitle.className = 'advantages-section-title';
        generalTitle.textContent = 'Avantages g√©n√©raux';
        container.appendChild(generalTitle);
        
        const generalGrid = document.createElement('div');
        generalGrid.className = 'options-grid-4col';
        container.appendChild(generalGrid);
        
        const avantagesGeneraux = characterData.avantagesGeneraux || [];
        
        avantagesGeneraux.forEach(adv => {
          const isSelected = creationState.secondaryAdvantages.some(a => a.id === adv.id && a.isGeneral);
          const card = document.createElement('div');
          card.className = 'option-checkbox-simple' + (isSelected ? ' selected' : '');
          card.innerHTML = `
            <span class="checkbox-mark"></span>
            <div>
              <div class="option-name">${adv.name}</div>
              <div class="option-desc">${adv.description}</div>
            </div>
          `;
          card.addEventListener('click', () => {
            if (isSelected) {
              creationState.secondaryAdvantages = creationState.secondaryAdvantages.filter(a => !(a.id === adv.id && a.isGeneral));
            } else if (totalSelected < 3) {
              creationState.secondaryAdvantages.push({ ...adv, isGeneral: true });
            }
            renderSecondaryAdvantageOptions();
          });
          generalGrid.appendChild(card);
        });
        
        // === SECTION 3: Avantages personnalis√©s ===
        const customTitle = document.createElement('h4');
        customTitle.className = 'advantages-section-title';
        customTitle.textContent = 'Avantages personnalis√©s';
        container.appendChild(customTitle);
        
        const customContainer = document.createElement('div');
        customContainer.className = 'custom-advantages-container';
        container.appendChild(customContainer);
        
        // Afficher les avantages personnalis√©s existants
        creationState.customAdvantages.forEach((customAdv, index) => {
          const customCard = document.createElement('div');
          customCard.className = 'custom-advantage-card selected';
          customCard.innerHTML = `
            <div class="custom-advantage-header">
              <input type="text" class="custom-advantage-name" placeholder="Nom de l'avantage" value="${customAdv.name || ''}" data-index="${index}">
              <button class="custom-advantage-remove" data-index="${index}" title="Supprimer">√ó</button>
            </div>
            <textarea class="custom-advantage-desc" placeholder="Description de l'avantage" data-index="${index}">${customAdv.description || ''}</textarea>
          `;
          customContainer.appendChild(customCard);
          
          // Event listeners pour les inputs
          const nameInput = customCard.querySelector('.custom-advantage-name');
          const descInput = customCard.querySelector('.custom-advantage-desc');
          const removeBtn = customCard.querySelector('.custom-advantage-remove');
          
          nameInput.addEventListener('input', (e) => {
            creationState.customAdvantages[index].name = e.target.value;
            updateSecondaryCount();
          });
          
          descInput.addEventListener('input', (e) => {
            creationState.customAdvantages[index].description = e.target.value;
          });
          
          removeBtn.addEventListener('click', () => {
            creationState.customAdvantages.splice(index, 1);
            renderSecondaryAdvantageOptions();
          });
        });
        
        // Bouton "+" pour ajouter un avantage personnalis√©
        if (totalSelected < 3) {
          const addBtn = document.createElement('div');
          addBtn.className = 'custom-advantage-add';
          addBtn.innerHTML = `
            <span class="add-icon">+</span>
            <span class="add-text">Ajouter un avantage personnalis√©</span>
          `;
          addBtn.addEventListener('click', () => {
            if (totalSelected < 3) {
              creationState.customAdvantages.push({ 
                id: 'custom-' + Date.now(), 
                name: '', 
                description: '',
                isCustom: true
              });
              renderSecondaryAdvantageOptions();
            }
          });
          customContainer.appendChild(addBtn);
        }
        
        // Update count
        updateSecondaryCount();
      }
      
      function updateSecondaryCount() {
        const totalSelected = creationState.secondaryAdvantages.length + creationState.customAdvantages.length;
        document.getElementById('secondary-count').textContent = totalSelected;
        
        // V√©rifier si tous les avantages personnalis√©s ont un nom
        const allCustomHaveNames = creationState.customAdvantages.every(adv => adv.name && adv.name.trim() !== '');
        
        document.getElementById('btn-next-6').disabled = totalSelected !== 3 || !allCustomHaveNames;
      }
      
      // √âtape 7: Nom et Stats
      let nameCheckHandler = null;
      
      function renderNameAndStats() {
        const nameInput = document.getElementById('wizard-name');
        const alignmentSelect = document.getElementById('wizard-alignment');
        const calculatedPV = document.getElementById('calculated-pv');
        const calculatedPF = document.getElementById('calculated-pf');
        const statsDetails = document.getElementById('stats-details');
        const btnNext = document.getElementById('btn-next-7');
        
        // Restaurer les valeurs si elles existent
        if (nameInput && creationState.name) {
          nameInput.value = creationState.name;
        }
        if (alignmentSelect && creationState.alignment) {
          alignmentSelect.value = creationState.alignment;
        }
        
        // Calculer les stats
        const { pv, force, intel, niveau, bonusPV, forceBonus, intelBonus } = calculatePV();
        const { pf, bonusPF } = calculatePF(pv);
        
        // Afficher les calculs
        if (calculatedPV) calculatedPV.textContent = pv;
        if (calculatedPF) calculatedPF.textContent = pf;
        
        // D√©tails du calcul
        if (statsDetails) {
          // Afficher FOR et INT avec leurs bonus si pr√©sents
          const forceDisplay = forceBonus > 0 ? `${force - forceBonus}+${forceBonus}=${force}` : force;
          const intelDisplay = intelBonus > 0 ? `${intel - intelBonus}+${intelBonus}=${intel}` : intel;
          
          let details = `<strong>Calcul des PV :</strong> FOR(${forceDisplay})√ó2 + INT(${intelDisplay})√ó2 + 10 + Niveau(${niveau})`;
          if (bonusPV > 0) details += ` + Bonus(${bonusPV})`;
          details += ` = <strong>${pv}</strong><br>`;
          details += `<strong>Calcul des PF :</strong> PV(${pv})`;
          if (bonusPF > 0) details += ` + Bonus(${bonusPF})`;
          details += ` = <strong>${pf}</strong>`;
          
          // Ajouter un r√©cap du personnage
          details += `<hr style="margin:0.75rem 0; border:none; border-top:1px dashed #ccc;">`;
          details += `<strong>R√©capitulatif :</strong><br>`;
          if (creationState.race) details += `‚Ä¢ Race : ${creationState.race.name}<br>`;
          if (creationState.classe) details += `‚Ä¢ Classe : ${creationState.classe.name}<br>`;
          
          // Afficher les caract√©ristiques avec leurs valeurs finales
          const formatAttr = (attr) => {
            const final = getFinalAttribute(attr);
            if (!final.value) return '‚Äî';
            return final.bonus > 0 ? `D${final.value}+${final.bonus} (${final.value + final.bonus})` : `D${final.value} (${final.value})`;
          };
          details += `‚Ä¢ FOR: ${formatAttr('force')} | DEX: ${formatAttr('dex')} | EMP: ${formatAttr('emp')} | SAG: ${formatAttr('sag')} | INT: ${formatAttr('int')}`;
          
          statsDetails.innerHTML = details;
        }
        
        // Fonction de validation (nom ET alignement requis)
        function validateStep7() {
          const nameOk = nameInput && nameInput.value.trim().length > 0;
          const alignmentOk = alignmentSelect && alignmentSelect.value !== '';
          
          // Stocker les valeurs dans creationState
          if (nameInput) creationState.name = nameInput.value.trim();
          if (alignmentSelect) creationState.alignment = alignmentSelect.value;
          
          if (btnNext) {
            btnNext.disabled = !(nameOk && alignmentOk);
          }
        }
        
        // Validation du nom et de l'alignement
        if (nameInput && alignmentSelect && btnNext) {
          // Supprimer les anciens handlers si existants
          if (nameCheckHandler) {
            nameInput.removeEventListener('input', nameCheckHandler);
            alignmentSelect.removeEventListener('change', nameCheckHandler);
          }
          
          // Cr√©er un nouveau handler
          nameCheckHandler = validateStep7;
          
          nameInput.addEventListener('input', nameCheckHandler);
          alignmentSelect.addEventListener('change', nameCheckHandler);
          nameCheckHandler(); // V√©rification initiale
        }
      }
      
      // √âtape 8: Level Up
      // Level Up options configuration
      const LEVELUP_OPTIONS = [
        { id: 'autre-classe', cost: 6, name: 'Avantage d\'autre classe', desc: '+1 Avantage/Capacit√© d\'une autre classe' },
        { id: 'caracteristique', cost: 5, name: '+1 D√© Caract√©ristique', desc: '+1 D√© sur une carac. (ou +1 bonus si d√©j√† D12)' },
        { id: 'classe-general', cost: 3, name: 'Avantage classe/g√©n√©ral', desc: '+1 Avantage/Capacit√© de sa classe ou g√©n√©ral' },
        { id: 'competence', cost: 1, name: '+1 Comp√©tence', desc: '+1 point de comp√©tence' }
      ];
      
      function renderLevelUpOptions() {
        const container = document.getElementById('level-up-container');
        const countInput = document.getElementById('levelup-count');
        const totalPointsSpan = document.getElementById('levelup-total-points');
        const minusBtn = document.getElementById('levelup-minus');
        const plusBtn = document.getElementById('levelup-plus');
        
        // Setup controls si pas d√©j√† fait
        if (!minusBtn.dataset.initialized) {
          minusBtn.dataset.initialized = 'true';
          
          minusBtn.addEventListener('click', () => {
            const current = parseInt(countInput.value) || 0;
            if (current > 0) {
              countInput.value = current - 1;
              updateLevelUpPoints();
            }
          });
          
          plusBtn.addEventListener('click', () => {
            const current = parseInt(countInput.value) || 0;
            if (current < 10) {
              countInput.value = current + 1;
              updateLevelUpPoints();
            }
          });
          
          countInput.addEventListener('change', () => {
            let val = parseInt(countInput.value) || 0;
            val = Math.max(0, Math.min(10, val));
            countInput.value = val;
            updateLevelUpPoints();
          });
        }
        
        // Restore value
        countInput.value = creationState.levelUpCount;
        
        updateLevelUpPoints();
        renderLevelUpContent();
      }
      
      function updateLevelUpPoints() {
        const countInput = document.getElementById('levelup-count');
        const totalPointsSpan = document.getElementById('levelup-total-points');
        
        creationState.levelUpCount = parseInt(countInput.value) || 0;
        creationState.levelUpPointsTotal = creationState.levelUpCount * 10;
        
        // Recalculer les points d√©pens√©s
        creationState.levelUpPointsSpent = creationState.levelUpChoices.reduce((sum, c) => sum + c.cost, 0);
        
        totalPointsSpan.textContent = `= ${creationState.levelUpPointsTotal} points`;
        
        renderLevelUpContent();
      }
      
      function renderLevelUpContent() {
        const container = document.getElementById('level-up-container');
        container.innerHTML = '';
        
        if (creationState.levelUpCount === 0) {
          container.innerHTML = `
            <p style="text-align:center;color:#666;padding:1rem;">
              Vous n'avez pas de Level Up. Utilisez les boutons ci-dessus pour ajouter des Level Up si vous commencez √† un niveau sup√©rieur √† 1.
            </p>
          `;
          return;
        }
        
        const pointsRemaining = creationState.levelUpPointsTotal - creationState.levelUpPointsSpent;
        
        // Points display
        const pointsDisplay = document.createElement('div');
        pointsDisplay.className = 'levelup-points-display';
        pointsDisplay.innerHTML = `
          <div style="font-size:14px; color:#666; margin-bottom:0.25rem;">Points restants</div>
          <div class="levelup-points-remaining ${pointsRemaining === 0 ? 'spent' : pointsRemaining <= 3 ? 'warning' : ''}">${pointsRemaining} / ${creationState.levelUpPointsTotal}</div>
        `;
        container.appendChild(pointsDisplay);
        
        // Options grid
        const optionsGrid = document.createElement('div');
        optionsGrid.className = 'levelup-options-grid';
        
        LEVELUP_OPTIONS.forEach(opt => {
          const canAfford = pointsRemaining >= opt.cost;
          const isSelected = creationState.levelUpCurrentSelection === opt.id;
          
          const card = document.createElement('div');
          card.className = 'levelup-option-card' + (isSelected ? ' selected' : '') + (!canAfford ? ' disabled' : '');
          card.innerHTML = `
            <div class="levelup-option-cost">${opt.cost} pt${opt.cost > 1 ? 's' : ''}</div>
            <div class="levelup-option-name">${opt.name}</div>
            <div class="levelup-option-desc">${opt.desc}</div>
          `;
          
          if (canAfford) {
            card.addEventListener('click', () => {
              creationState.levelUpCurrentSelection = isSelected ? null : opt.id;
              renderLevelUpContent();
            });
          }
          
          optionsGrid.appendChild(card);
        });
        
        container.appendChild(optionsGrid);
        
        // Selection panel (if an option is selected)
        if (creationState.levelUpCurrentSelection) {
          const selectionPanel = document.createElement('div');
          selectionPanel.className = 'levelup-selection-panel';
          renderSelectionPanel(selectionPanel, creationState.levelUpCurrentSelection, pointsRemaining);
          container.appendChild(selectionPanel);
        }
        
        // Current choices list
        if (creationState.levelUpChoices.length > 0) {
          const choicesList = document.createElement('div');
          choicesList.className = 'levelup-choices-list';
          choicesList.innerHTML = '<strong style="color:#8b0000;">üéØ Am√©liorations choisies :</strong>';
          
          creationState.levelUpChoices.forEach((choice, index) => {
            const item = document.createElement('div');
            item.className = 'levelup-choice-item';
            item.innerHTML = `
              <span><strong>${choice.cost} pts</strong> - ${choice.label}</span>
              <button class="levelup-choice-remove" data-index="${index}">‚úï Retirer</button>
            `;
            item.querySelector('button').addEventListener('click', () => {
              // Retirer le choix et recalculer les points
              const removedChoice = creationState.levelUpChoices.splice(index, 1)[0];
              creationState.levelUpPointsSpent -= removedChoice.cost;
              renderLevelUpContent();
            });
            choicesList.appendChild(item);
          });
          
          container.appendChild(choicesList);
        }
      }
      
      function renderSelectionPanel(panel, optionId, pointsRemaining) {
        const opt = LEVELUP_OPTIONS.find(o => o.id === optionId);
        if (!opt) return;
        
        panel.innerHTML = `<div class="levelup-selection-title">Choisissez : ${opt.name} (${opt.cost} pts)</div>`;
        
        const content = document.createElement('div');
        
        switch (optionId) {
          case 'competence':
            renderCompetenceSelection(content, opt.cost);
            break;
          case 'caracteristique':
            renderCaracteristiqueSelection(content, opt.cost);
            break;
          case 'classe-general':
            renderClasseGeneralSelection(content, opt.cost);
            break;
          case 'autre-classe':
            renderAutreClasseSelection(content, opt.cost);
            break;
        }
        
        panel.appendChild(content);
      }
      
      function renderCompetenceSelection(container, cost) {
        container.innerHTML = '<p style="margin-bottom:0.75rem; color:#666;">S√©lectionnez une comp√©tence √† am√©liorer (+1) :</p>';
        
        const grid = document.createElement('div');
        grid.className = 'levelup-comp-grid';
        grid.style.cssText = 'display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:0.5rem; max-height:200px; overflow-y:auto;';
        
        characterData.competences.forEach(comp => {
          const btn = document.createElement('button');
          btn.style.cssText = 'padding:0.5rem; border:1px solid #ddd; border-radius:0.25rem; background:#fff; cursor:pointer; text-align:left; font-size:12px;';
          btn.innerHTML = `<strong>${comp.name}</strong> <span style="color:#888;">(${comp.attribut})</span>`;
          btn.addEventListener('click', () => {
            addLevelUpChoice({
              type: 'competence',
              cost: cost,
              label: `+1 ${comp.name} (${comp.attribut})`,
              details: { compId: comp.id, compName: comp.name }
            });
          });
          btn.addEventListener('mouseover', () => btn.style.borderColor = '#8b0000');
          btn.addEventListener('mouseout', () => btn.style.borderColor = '#ddd');
          grid.appendChild(btn);
        });
        
        container.appendChild(grid);
      }
      
      function renderCaracteristiqueSelection(container, cost) {
        container.innerHTML = '<p style="margin-bottom:0.75rem; color:#666;">S√©lectionnez une caract√©ristique √† am√©liorer :</p>';
        
        const attrs = ['force', 'dex', 'emp', 'sag', 'int'];
        const attrNames = { force: 'Force (FOR)', dex: 'Dext√©rit√© (DEX)', emp: 'Empathie (EMP)', sag: 'Sagesse (SAG)', int: 'Intelligence (INT)' };
        const diceProgression = [4, 6, 8, 10, 12];
        
        const grid = document.createElement('div');
        grid.className = 'levelup-carac-grid';
        grid.style.cssText = 'display:grid; grid-template-columns:repeat(5, 1fr); gap:0.5rem;';
        
        attrs.forEach(attr => {
          const baseDie = creationState.attributes[attr] || 4;
          const raceBonus = creationState.attributeBonuses[attr] || 0;
          
          // Nombre de level ups d√©j√† choisis pour cette caract√©ristique
          const levelUpCount = creationState.levelUpChoices
            .filter(c => c.type === 'caracteristique' && c.details && c.details.attr === attr)
            .length;
          
          // Calculer l'√©tat actuel (base + race + level ups existants)
          let currentIndex = diceProgression.indexOf(baseDie);
          if (currentIndex === -1) currentIndex = 0;
          
          let currentExtraBonus = 0;
          const totalBonusSteps = raceBonus + levelUpCount;
          
          for (let i = 0; i < totalBonusSteps; i++) {
            if (currentIndex < diceProgression.length - 1) {
              currentIndex++;
            } else {
              currentExtraBonus++;
            }
          }
          
          const currentDie = diceProgression[currentIndex];
          
          // Calculer ce qui se passe avec +1 level up suppl√©mentaire
          let nextDie = currentDie;
          let nextExtraBonus = currentExtraBonus;
          
          if (currentIndex < diceProgression.length - 1) {
            nextDie = diceProgression[currentIndex + 1];
          } else {
            nextExtraBonus = currentExtraBonus + 1;
          }
          
          // Construire le texte d'effet
          let effectText = '';
          let currentDisplay = `D${currentDie}${currentExtraBonus > 0 ? '+' + currentExtraBonus : ''}`;
          let nextDisplay = `D${nextDie}${nextExtraBonus > 0 ? '+' + nextExtraBonus : ''}`;
          effectText = `${currentDisplay} ‚Üí ${nextDisplay}`;
          
          const btn = document.createElement('button');
          btn.style.cssText = 'padding:0.75rem 0.5rem; border:2px solid #ddd; border-radius:0.5rem; background:#fff; cursor:pointer; text-align:center;';
          btn.innerHTML = `
            <div style="font-weight:bold; font-size:13px;">${attrNames[attr].split(' ')[0]}</div>
            <div style="font-size:11px; color:#666;">Actuel: ${currentDisplay}</div>
            <div style="font-size:10px; color:#27ae60; margin-top:0.25rem;">${effectText}</div>
          `;
          btn.addEventListener('click', () => {
            addLevelUpChoice({
              type: 'caracteristique',
              cost: cost,
              label: `+1 ${attrNames[attr].split(' ')[0]} (${effectText})`,
              details: { attr: attr }
            });
          });
          btn.addEventListener('mouseover', () => btn.style.borderColor = '#8b0000');
          btn.addEventListener('mouseout', () => btn.style.borderColor = '#ddd');
          grid.appendChild(btn);
        });
        
        container.appendChild(grid);
      }
      
      // V√©rifie si un avantage est d√©j√† choisi (√©tapes pr√©c√©dentes ou level ups)
      function isAdvantageAlreadyChosen(advId) {
        // V√©rifier l'avantage primaire (√©tape 4)
        if (creationState.primaryAdvantage && creationState.primaryAdvantage.id === advId) {
          return true;
        }
        
        // V√©rifier les avantages secondaires (√©tape 6)
        if (creationState.secondaryAdvantages.some(a => a.id === advId)) {
          return true;
        }
        
        // V√©rifier les avantages personnalis√©s (√©tape 6)
        if (creationState.customAdvantages.some(a => a.id === advId)) {
          return true;
        }
        
        // V√©rifier les choix de level up
        if (creationState.levelUpChoices.some(c => c.details && c.details.advId === advId)) {
          return true;
        }
        
        return false;
      }
      
      function renderClasseGeneralSelection(container, cost) {
        container.innerHTML = '';
        
        // Section: Avantages de classe
        if (creationState.classe && creationState.classe.avantages) {
          const classSection = document.createElement('div');
          classSection.innerHTML = `<p style="margin-bottom:0.5rem; color:#666;"><strong>Avantages de votre classe (${creationState.classe.name}) :</strong></p>`;
          
          const classGrid = document.createElement('div');
          classGrid.className = 'levelup-adv-grid';
          classGrid.style.cssText = 'display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:0.5rem; margin-bottom:1rem; max-height:150px; overflow-y:auto;';
          
          const availableClassAdvantages = creationState.classe.avantages.filter(adv => !isAdvantageAlreadyChosen(adv.id));
          
          if (availableClassAdvantages.length === 0) {
            classGrid.innerHTML = '<p style="color:#999; font-style:italic; padding:0.5rem;">Tous les avantages de classe ont √©t√© choisis.</p>';
          } else {
            availableClassAdvantages.forEach(adv => {
              const btn = document.createElement('button');
              btn.style.cssText = 'padding:0.5rem; border:1px solid #ddd; border-radius:0.25rem; background:#fff; cursor:pointer; text-align:left; font-size:11px;';
              btn.innerHTML = `<strong>${adv.name}</strong><br><span style="color:#666;">${adv.description.substring(0, 60)}${adv.description.length > 60 ? '...' : ''}</span>`;
              btn.addEventListener('click', () => {
                addLevelUpChoice({
                  type: 'classe-general',
                  cost: cost,
                  label: `${adv.name} (Classe)`,
                  details: { advId: adv.id, advName: adv.name, advDesc: adv.description, source: 'classe' }
                });
              });
              btn.addEventListener('mouseover', () => btn.style.borderColor = '#8b0000');
              btn.addEventListener('mouseout', () => btn.style.borderColor = '#ddd');
              classGrid.appendChild(btn);
            });
          }
          
          classSection.appendChild(classGrid);
          container.appendChild(classSection);
        }
        
        // Section: Avantages g√©n√©raux
        const generalSection = document.createElement('div');
        generalSection.innerHTML = `<p style="margin-bottom:0.5rem; color:#666;"><strong>Avantages g√©n√©raux :</strong></p>`;
        
        const generalGrid = document.createElement('div');
        generalGrid.className = 'levelup-adv-grid';
        generalGrid.style.cssText = 'display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:0.5rem; max-height:150px; overflow-y:auto;';
        
        const availableGeneralAdvantages = (characterData.avantagesGeneraux || []).filter(adv => !isAdvantageAlreadyChosen(adv.id));
        
        if (availableGeneralAdvantages.length === 0) {
          generalGrid.innerHTML = '<p style="color:#999; font-style:italic; padding:0.5rem;">Tous les avantages g√©n√©raux ont √©t√© choisis.</p>';
        } else {
          availableGeneralAdvantages.forEach(adv => {
            const btn = document.createElement('button');
            btn.style.cssText = 'padding:0.5rem; border:1px solid #ddd; border-radius:0.25rem; background:#fff; cursor:pointer; text-align:left; font-size:11px;';
            btn.innerHTML = `<strong>${adv.name}</strong><br><span style="color:#666;">${adv.description.substring(0, 60)}${adv.description.length > 60 ? '...' : ''}</span>`;
            btn.addEventListener('click', () => {
              addLevelUpChoice({
                type: 'classe-general',
                cost: cost,
                label: `${adv.name} (G√©n√©ral)`,
                details: { advId: adv.id, advName: adv.name, advDesc: adv.description, source: 'general' }
              });
            });
            btn.addEventListener('mouseover', () => btn.style.borderColor = '#8b0000');
            btn.addEventListener('mouseout', () => btn.style.borderColor = '#ddd');
            generalGrid.appendChild(btn);
          });
        }
        
        generalSection.appendChild(generalGrid);
        container.appendChild(generalSection);
      }
      
      function renderAutreClasseSelection(container, cost) {
        container.innerHTML = '<p style="margin-bottom:0.75rem; color:#666;">S√©lectionnez d\'abord une classe, puis un avantage :</p>';
        
        // Liste des autres classes
        const classSelect = document.createElement('select');
        classSelect.style.cssText = 'width:100%; padding:0.5rem; margin-bottom:1rem; border:2px solid #ddd; border-radius:0.25rem; font-size:14px;';
        classSelect.innerHTML = '<option value="">-- Choisir une classe --</option>';
        
        characterData.classes.forEach(cls => {
          if (!creationState.classe || cls.id !== creationState.classe.id) {
            classSelect.innerHTML += `<option value="${cls.id}">${cls.name}</option>`;
          }
        });
        
        const advantagesContainer = document.createElement('div');
        advantagesContainer.className = 'levelup-adv-grid';
        advantagesContainer.style.cssText = 'display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:0.5rem; max-height:200px; overflow-y:auto;';
        
        classSelect.addEventListener('change', () => {
          advantagesContainer.innerHTML = '';
          const selectedClass = characterData.classes.find(c => c.id === classSelect.value);
          if (!selectedClass) return;
          
          // Filtrer les avantages d√©j√† choisis
          const availableAdvantages = (selectedClass.avantages || []).filter(adv => !isAdvantageAlreadyChosen(adv.id));
          
          if (availableAdvantages.length === 0) {
            advantagesContainer.innerHTML = '<p style="color:#999; font-style:italic; padding:0.5rem;">Tous les avantages de cette classe ont √©t√© choisis.</p>';
          } else {
            availableAdvantages.forEach(adv => {
              const btn = document.createElement('button');
              btn.style.cssText = 'padding:0.5rem; border:1px solid #ddd; border-radius:0.25rem; background:#fff; cursor:pointer; text-align:left; font-size:11px;';
              btn.innerHTML = `<strong>${adv.name}</strong><br><span style="color:#666;">${adv.description.substring(0, 60)}${adv.description.length > 60 ? '...' : ''}</span>`;
              btn.addEventListener('click', () => {
                addLevelUpChoice({
                  type: 'autre-classe',
                  cost: cost,
                  label: `${adv.name} (${selectedClass.name})`,
                  details: { advId: adv.id, advName: adv.name, advDesc: adv.description, className: selectedClass.name }
                });
              });
              btn.addEventListener('mouseover', () => btn.style.borderColor = '#8b0000');
              btn.addEventListener('mouseout', () => btn.style.borderColor = '#ddd');
              advantagesContainer.appendChild(btn);
            });
          }
        });
        
        container.appendChild(classSelect);
        container.appendChild(advantagesContainer);
      }
      
      function addLevelUpChoice(choice) {
        const pointsRemaining = creationState.levelUpPointsTotal - creationState.levelUpPointsSpent;
        if (choice.cost > pointsRemaining) return;
        
        creationState.levelUpChoices.push(choice);
        creationState.levelUpPointsSpent += choice.cost;
        creationState.levelUpCurrentSelection = null;
        
        renderLevelUpContent();
      }
      
      // Appliquer les choix de Level Up √† la fiche
      function applyLevelUpChoices() {
        if (creationState.levelUpChoices.length === 0 && creationState.levelUpCount === 0) return;
        
        // Mettre √† jour le niveau sur la fiche
        const levelField = document.getElementById('level');
        if (levelField) {
          levelField.value = 1 + creationState.levelUpCount;
        }
        
        // Parcourir les choix qui ne sont pas d√©j√† g√©r√©s ailleurs
        // - Comp√©tences : g√©r√©es dans updateSheetCompetences()
        // - Caract√©ristiques : g√©r√©es dans updateSheetAttributes() via getFinalAttribute()
        creationState.levelUpChoices.forEach(choice => {
          switch (choice.type) {
            case 'competence':
            case 'caracteristique':
              // D√©j√† g√©r√©s dans les fonctions de mise √† jour
              break;
            case 'classe-general':
            case 'autre-classe':
              applyLevelUpAdvantage(choice);
              break;
          }
        });
        
        // Recalculer PV/PF avec le nouveau niveau
        const { pv } = calculatePV();
        const { pf } = calculatePF(pv);
        
        const pvMaxField = document.getElementById('pv-max');
        const pvCurrentField = document.getElementById('pv-current');
        const pfMaxField = document.getElementById('pf-max');
        const pfCurrentField = document.getElementById('pf-current');
        
        if (pvMaxField) pvMaxField.value = pv;
        if (pvCurrentField) pvCurrentField.value = pv;
        if (pfMaxField) pfMaxField.value = pf;
        if (pfCurrentField) pfCurrentField.value = pf;
      }
      
      function applyLevelUpCompetence(details) {
        // Ajouter +1 √† la comp√©tence dans le tableau
        const skillsBody = document.querySelector('.skill-table tbody');
        if (!skillsBody) return;
        
        const comp = characterData.competences.find(c => c.id === details.compId);
        if (!comp) return;
        
        // Chercher si la comp√©tence existe d√©j√†
        const rows = skillsBody.querySelectorAll('tr');
        let found = false;
        
        for (const row of rows) {
          const nameCell = row.querySelector('td:first-child input');
          if (nameCell && nameCell.value === comp.name) {
            // Incr√©menter le bonus existant
            const bonusCell = row.querySelector('td:last-child input');
            if (bonusCell) {
              let currentBonus = parseInt(bonusCell.value.replace(/[^0-9-]/g, '')) || 0;
              bonusCell.value = '+' + (currentBonus + 1);
              found = true;
              break;
            }
          }
        }
        
        // Si pas trouv√©e, chercher une ligne vide ou en cr√©er une nouvelle
        if (!found) {
          // Chercher une ligne vide
          let emptyRow = null;
          for (const row of rows) {
            const nameCell = row.querySelector('td:first-child input');
            if (nameCell && !nameCell.value.trim()) {
              emptyRow = row;
              break;
            }
          }
          
          if (emptyRow) {
            // Utiliser la ligne vide
            const cells = emptyRow.querySelectorAll('td input');
            if (cells.length >= 3) {
              cells[0].value = comp.name;
              cells[1].value = comp.attribut;
              cells[2].value = '+1';
            }
          } else {
            // Cr√©er une nouvelle ligne
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
              <td><input value="${comp.name}" /></td>
              <td><input value="${comp.attribut}" /></td>
              <td><input type="text" value="+1" style="text-align:center;" /></td>
            `;
            skillsBody.appendChild(newRow);
          }
        }
      }
      
      function applyLevelUpCaracteristique(details) {
        const attr = details.attr;
        // Les IDs correspondent aux noms des attributs dans le HTML
        const attrMapping = { force: 'force', dex: 'dex', emp: 'emp', sag: 'sag', int: 'int' };
        const fieldId = attrMapping[attr];
        
        // R√©cup√©rer le champ principal de la caract√©ristique
        const valueField = document.getElementById(fieldId);
        if (!valueField) return;
        
        // Le champ bonus est le deuxi√®me input dans le m√™me conteneur (apr√®s le dice span)
        const container = valueField.closest('.value-wrap');
        const bonusField = container ? container.querySelector('input[type="text"]') : null;
        
        let currentValue = parseInt(valueField.value) || 4;
        let currentBonus = parseInt(bonusField?.value?.replace(/[^0-9-]/g, '')) || 0;
        
        if (currentValue < 12) {
          // Augmenter le d√©
          valueField.value = Math.min(12, currentValue + 2);
        } else {
          // D√©j√† au max, augmenter le bonus
          if (bonusField) {
            bonusField.value = '+' + (currentBonus + 1);
          }
        }
      }
      
      function applyLevelUpAdvantage(choice) {
        // Ajouter l'avantage √† la liste des capacit√©s
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
          const h3 = section.querySelector('h3');
          if (h3 && (h3.textContent.includes('Capacit√©s') || h3.textContent.includes('Avantages'))) {
            const list = section.querySelector('.abilities-list');
            if (list) {
              const li = document.createElement('li');
              const prefix = choice.type === 'autre-classe' ? '‚¨° ' : '‚óÜ ';
              li.innerHTML = `<strong>${prefix}${choice.details.advName}</strong> : ${choice.details.advDesc}`;
              list.appendChild(li);
            }
          }
        });
      }
      
      // Finaliser la fiche
      function generateCharacterSheet() {
        // Appliquer toutes les √©tapes une derni√®re fois pour s'assurer que tout est √† jour
        updateSheetRace();
        updateSheetAttributes();
        updateSheetClass();
        updateSheetCapacities();
        updateSheetCompetences();
        updateSheetNameAndStats();
        applyLevelUpChoices();
        
        // Afficher l'√©tape 9 dans la progress bar
        const step9 = document.querySelector('.progress-step[data-step="9"]');
        step9.style.display = 'flex';
        
        // Marquer toutes les √©tapes comme compl√©t√©es et activer l'√©tape 9
        document.querySelectorAll('.progress-step').forEach(step => {
          const stepNum = parseInt(step.dataset.step);
          step.classList.remove('active', 'completed');
          if (stepNum === 9) {
            step.classList.add('active');
          } else {
            step.classList.add('completed');
          }
        });
        
        // Cacher le contenu de l'√©tape actuelle
        document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
        
        // Afficher un message de succ√®s (sans masquer le wizard)
        const separator = document.getElementById('wizard-separator');
        separator.style.display = 'block';
        separator.innerHTML = `
          <div style="text-align: center; padding: 1rem;">
            <h3 style="color: #27ae60; margin-bottom: 0.5rem;">‚úÖ Cr√©ation termin√©e - Fiche √©ditable</h3>
            <p style="color: #666; margin: 0;">Pour revenir sur des √©l√©ments de la cr√©ation, cliquez sur la bulle correspondante au-dessus.<br>
            <em style="color: #e74c3c;">‚ö†Ô∏è Cela annulera vos modifications manuelles sur la fiche.</em></p>
          </div>
        `;
        
        // Mettre √† jour currentStep pour la navigation
        currentStep = 9;
        
        // Scroller vers la fiche
        document.getElementById('character-sheet').scrollIntoView({ behavior: 'smooth' });
        
        // Afficher une notification temporaire
        const notification = document.createElement('div');
        notification.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#27ae60;color:#fff;padding:1rem 2rem;border-radius:0.5rem;font-weight:bold;z-index:9999;box-shadow:0 4px 15px rgba(0,0,0,0.2);';
        notification.textContent = '‚úÖ Fiche g√©n√©r√©e ! Cliquez sur une √©tape pour modifier.';
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 4000);
      }
      
      // Initialiser
      initWizard();
    })();
  </script>